"use strict";(globalThis.webpackChunkvocechat_web=globalThis.webpackChunkvocechat_web||[]).push([[954],{24041:(e,t,s)=>{s.d(t,{Z:()=>i});var r,a=s(70537);function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},n.apply(this,arguments)}const l=(e,t)=>{let{title:s,titleId:l,...i}=e;return a.createElement("svg",n({width:16,height:16,viewBox:"0 0 16 16",fill:"#6C737F",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":l},i),s?a.createElement("title",{id:l},s):null,r||(r=a.createElement("path",{d:"M8.11904 0C3.91105 0 0.5 3.41105 0.5 7.61905C0.5 11.827 3.91105 15.2381 8.11904 15.2381C12.3271 15.2381 15.7381 11.827 15.7381 7.61905C15.7381 3.41105 12.3263 0 8.11904 0ZM11.7053 10.128L10.628 11.2053L8.11904 8.69714L5.61009 11.2053L4.53277 10.128L7.04095 7.61905L4.532 5.1101L5.60934 4.03353L8.11829 6.54248L10.6272 4.03353L11.7045 5.1101L9.19638 7.61905L11.7053 10.128Z"})))},i=(0,a.forwardRef)(l)},11972:(e,t,s)=>{s.d(t,{Z:()=>i});var r,a=s(70537);function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},n.apply(this,arguments)}const l=(e,t)=>{let{title:s,titleId:l,...i}=e;return a.createElement("svg",n({width:24,height:24,viewBox:"0 0 24 24",fill:"#fff",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":l},i),s?a.createElement("title",{id:l},s):null,r||(r=a.createElement("path",{d:"M16.5303 11.7204L16.4462 11.6478C16.1526 11.4299 15.7359 11.4541 15.4697 11.7204L12.7503 14.4397L12.75 7.75003L12.7432 7.64826C12.6935 7.28218 12.3797 7.00003 12 7.00003L11.8982 7.00688C11.5322 7.05654 11.25 7.37033 11.25 7.75003L11.2503 14.4417L8.52961 11.7198L8.4455 11.6472C8.15193 11.4293 7.73527 11.4534 7.46895 11.7196C7.176 12.0124 7.17591 12.4873 7.46875 12.7803L11.4687 16.7818L11.5529 16.8544C11.8465 17.0724 12.2632 17.0482 12.5295 16.7819L16.5303 12.7811L16.6029 12.6969C16.8208 12.4033 16.7966 11.9867 16.5303 11.7204ZM6.25 3C4.45507 3 3 4.45507 3 6.25V17.75C3 19.5449 4.45507 21 6.25 21H17.75C19.5449 21 21 19.5449 21 17.75V6.25C21 4.45507 19.5449 3 17.75 3H6.25ZM4.5 6.25C4.5 5.2835 5.2835 4.5 6.25 4.5H17.75C18.7165 4.5 19.5 5.2835 19.5 6.25V17.75C19.5 18.7165 18.7165 19.5 17.75 19.5H6.25C5.2835 19.5 4.5 18.7165 4.5 17.75V6.25Z"})))},i=(0,a.forwardRef)(l)},10189:(e,t,s)=>{s.d(t,{Z:()=>i});var r,a=s(70537);function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},n.apply(this,arguments)}const l=(e,t)=>{let{title:s,titleId:l,...i}=e;return a.createElement("svg",n({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":l},i),s?a.createElement("title",{id:l},s):null,r||(r=a.createElement("path",{d:"M14.2958 16.2945C13.9055 16.6853 13.906 17.3184 14.2968 17.7087C14.6876 18.0989 15.3207 18.0985 15.711 17.7077L20.7076 12.7043C21.0976 12.3137 21.0974 11.681 20.7072 11.2906L15.7106 6.29297C15.3201 5.9024 14.6869 5.90234 14.2964 6.29282C13.9058 6.6833 13.9057 7.31647 14.2962 7.70703L17.589 11H11C6.66509 11 3.13546 14.4478 3.00381 18.7508L3 19C3 19.5523 3.44772 20 4 20C4.55228 20 5 19.5523 5 19C5 15.7616 7.56557 13.1224 10.7751 13.0041L11 13H17.586L14.2958 16.2945Z",fill:"#667085"})))},i=(0,a.forwardRef)(l)},79180:(e,t,s)=>{s.d(t,{Z:()=>d});var r=s(70537),a=s(97943),n=s(81721),l=s(18225),i=s(80874),o=s(14566),c=s(80683);const d=e=>{let{download:t=!0,data:s,closeModal:d}=e;const{t:u}=(0,o.$G)(),[f,x]=(0,r.useState)(null===s||void 0===s?void 0:s.thumbnail),[m,p]=(0,r.useState)(!0),h=(0,r.useRef)(null);if((0,a.O)(h,d),(0,n.z)("Escape",(()=>{d()}),{eventTypes:["keyup"]}),(0,r.useEffect)((()=>{if(s){const{originUrl:e}=s;e||p(!1);const t=new Image;t.src=e,t.onload=()=>{x(e),p(!1)},t.onerror=()=>{p(!1)}}}),[s]),!s)return null;const{originUrl:g,downloadLink:v,name:w,type:j}=s;return(0,c.jsx)(i.Z,{children:(0,c.jsx)("div",{className:"w-screen h-screen flex-center bg-black/90",children:(0,c.jsxs)("div",{className:"relative flex flex-col justify-start gap-3",ref:h,children:[(0,c.jsx)("div",{className:"overflow-auto",children:(0,c.jsx)("img",{className:"max-w-[70vw] max-h-[80vh] "+(m?"blur-sm":""),src:f,alt:"preview"})}),t&&(0,c.jsx)("a",{className:"font-semibold text-sm text-gray-600 hover:underline hover:text-white",download:w,type:j,href:v||g,rel:"noreferrer",children:u("action.download_origin")}),m&&(0,c.jsx)("div",{className:"absolute top-[40%] left-1/2 -translate-x-1/2",children:(0,c.jsx)(l.Z,{})})]})})})}},7935:(e,t,s)=>{s.d(t,{Z:()=>f});var r=s(24533),a=(s(34376),s(70537)),n=s(24783),l=s(80683);function i(e){let{url:t=""}=e;const[s,r]=(0,a.useState)(""),[i]=(0,n.rf)(),[o,c]=(0,a.useState)(null);(0,a.useEffect)((()=>{(async e=>{var t;let s="";try{s=`${new URL(e).origin}/favicon.ico`}catch{s=`${location.origin}/favicon.ico`}const{data:a}=await i(e),n=(null===a||void 0===a?void 0:a.title)||(null===a||void 0===a?void 0:a.site_name)||"",l=(null===a||void 0===a?void 0:a.description)||"",o=(null===a||void 0===a||null===(t=a.images.find((e=>!!e.url)))||void 0===t?void 0:t.url)||"",d=(null===a||void 0===a?void 0:a.favicon_url)||s;r(d),c({title:n,description:l,ogImage:o})})(t)}),[t]);if(!t||!o||!o.title)return null;const{title:d,description:u,ogImage:f}=o,x="flex items-center border border-solid border-gray-300 box-border rounded-md w-[380px]",m="overflow-hidden whitespace-nowrap text-ellipsis";return f?(0,l.jsxs)("a",{className:`${x} flex-col !items-start p-3`,href:t,target:"_blank",rel:"noreferrer",children:[(0,l.jsx)("h3",{className:`text-base text-primary-500 w-full ${m}`,children:d}),(0,l.jsx)("p",{className:`text-xs text-gray-400 mb-2 w-full ${m}`,children:u}),(0,l.jsx)("div",{className:"w-full h-[180px]",children:(0,l.jsx)("img",{className:"w-full h-full object-cover",onError:()=>{c((e=>e?{...e,ogImage:""}:e))},src:f,alt:"og image"})})]}):(0,l.jsxs)("a",{className:`${x} gap-2  px-2 py-3`,href:t,target:"_blank",rel:"noreferrer",children:[s&&(0,l.jsx)("div",{className:"flex w-12 h-12 rounded",children:(0,l.jsx)("img",{onError:()=>{r("")},className:"object-contain",src:s,alt:"favicon"})}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("h3",{className:"text-sm text-gray-900",children:d}),(0,l.jsx)("p",{className:`text-xs text-gray-500 w-[288px] ${m}`,children:u}),(0,l.jsx)("span",{className:`text-[10px] text-gray-500 w-[288px] ${m}`,children:t})]})]})}var o=s(7829),c=s(78468),d=s(66160);const u=e=>{let{uid:t,popover:s=!0,cid:r,textOnly:a=!1}=e;const n=(0,d.CG)((e=>e.users.byId))[t];return n?a?(0,l.jsx)(l.Fragment,{children:`@${n.name}`}):s?(0,l.jsx)(o.ZP,{interactive:!0,placement:"top",trigger:"click",content:(0,l.jsx)(c.Z,{uid:t,type:"card",cid:r}),children:(0,l.jsx)("span",{className:"px-0.5 text-primary-400 cursor-pointer",children:`@${n.name}`})}):(0,l.jsx)("span",{className:"px-0.5 text-primary-400",children:`@${n.name}`}):null},f=e=>{let{url:t=!0,mention:s=!0,mentionTextOnly:a=!1,mentionPopOver:n=!0,text:o,cid:c}=e;return(0,l.jsx)(r.Z,{options:{render:{email:e=>{let{content:t,attributes:{href:s}}=e;return a?(0,l.jsx)(l.Fragment,{children:t}):(0,l.jsx)("a",{className:"link",href:s,rel:"noreferrer",children:t})},url:e=>{let{content:s,attributes:{href:r}}=e;return t?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("a",{className:"link",target:"_blank",href:r,rel:"noreferrer",children:s}),(0,l.jsx)(i,{url:r})]}):(0,l.jsx)(l.Fragment,{children:s})},mention:e=>{let{content:t}=e;if(!s)return(0,l.jsx)(l.Fragment,{children:t});if(/@[0-9]+/.test(t)){const e=t.trim().slice(1);return(0,l.jsx)(u,{uid:+e,cid:c,popover:n,textOnly:a})}return(0,l.jsx)(l.Fragment,{children:t})}}},children:o})}},84006:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(70537),a=(s(85012),s(69495),s(55403)),n=s.n(a),l=s(85606),i=s(79180),o=s(80683);const c=e=>{let{content:t}=e;const s=(0,r.useRef)(null),[a,c]=(0,r.useState)(null);(0,r.useEffect)((()=>{const e=null===s||void 0===s?void 0:s.current;e&&e.addEventListener("click",(e=>{e.stopPropagation();const t=e.target;if(t&&"IMG"==t.nodeName){const e=new URL(t.src),s=`${e.origin}${e.pathname}?file_path=${e.searchParams.get("file_path")}`;c({originUrl:s})}}),!0)}),[]);return(0,o.jsxs)(o.Fragment,{children:[a&&(0,o.jsx)(i.Z,{download:!1,data:a,closeModal:()=>{c(null)}}),(0,o.jsx)("div",{ref:s,id:"MARKDOWN_CONTAINER",children:(0,o.jsx)(l.A,{initialValue:t,plugins:[n()]})})]})}},96954:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(70537),a=s(26201),n=s(64631),l=s(11855),i=s(80683);const o=e=>{let{id:t=""}=e;const{favorites:s}=(0,l.Z)({}),[o,c]=(0,r.useState)(null);return(0,r.useEffect)((()=>{const e=s.find((e=>e.id==t)),{messages:r}=e||{};if(!r)return;const l=r.map((e=>{let{from_mid:t}=e;return+t}))||[];c((0,i.jsx)("div",{"data-favorite-mids":l.join(","),className:"favorite flex flex-col rounded-md bg-slate-50 dark:bg-slate-800",children:(0,i.jsx)("div",{className:"list",children:r.map(((e,t)=>{const{user:s={},download:r,content:l,content_type:o,properties:c,thumbnail:d}=e;return(0,i.jsxs)("div",{className:"w-full relative flex items-start gap-3 px-2 py-1 my-2 rounded-lg dark:hover:bg-gray-800",children:[s&&(0,i.jsx)("div",{className:"",children:(0,i.jsx)(n.Z,{width:40,height:40,src:s.avatar,name:s.name})}),(0,i.jsxs)("div",{className:"w-full flex flex-col gap-2 text-sm",children:[(0,i.jsx)("div",{className:"flex items-center gap-2 font-semibold",children:(0,i.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:(null===s||void 0===s?void 0:s.name)||"Deleted User"})}),(0,i.jsx)("div",{className:"select-text text-gray-800 break-all whitespace-pre-wrap dark:text-white",children:(0,a.Z)({download:r,content:l,content_type:o,properties:c,thumbnail:d})})]})]},t)}))})}))}),[s,t]),t?o:null}},26201:(e,t,s)=>{s.d(t,{Z:()=>z});var r=s(7699),a=s.n(r),n=s(18541),l=s(80308),i=s(70537),o=s(64631),c=s(10189),d=s(21812),u=s(24783);var f=s(14566),x=s(80683);const m=e=>{let{context:t,to:s,from_uid:r,id:a}=e;const{t:n}=(0,f.$G)(),{normalizeMessage:l,messages:m}=function(){const[e,t]=(0,i.useState)(null),[s,r]=(0,i.useState)(null),[a,{data:n,isError:l,isLoading:o,isSuccess:c}]=(0,u.uv)();return(0,i.useEffect)((()=>{if(n&&c){const t=(0,d.Hr)(n,e);r(t)}}),[n,c,e]),(0,i.useEffect)((()=>{e&&a(e)}),[e]),{normalizeMessage:e=>{t(e)},messages:s,isError:l,isLoading:o,isSuccess:c}}(),[p,h]=(0,i.useState)(null);return(0,i.useEffect)((()=>{a&&l(a)}),[a]),(0,i.useEffect)((()=>{if(m){const e=m.map((e=>{let{from_mid:t}=e;return t}))||[];h((0,x.jsxs)("div",{"data-forwarded-mids":e.join(","),className:"flex flex-col rounded-lg bg-gray-100 dark:bg-gray-900",children:[(0,x.jsxs)("h4",{className:"p-2 pb-0 flex items-center gap-1 text-gray-500 text-xs",children:[(0,x.jsx)(c.Z,{className:"w-4 h-4 fill-gray-500"}),n("action.forward")]}),(0,x.jsx)("div",{className:"list",children:m.map(((e,a)=>{const{user:n={},download:l,content:i,content_type:c,properties:d,thumbnail:u}=e;return(0,x.jsxs)("div",{className:"w-full relative flex items-start gap-4 px-2 py-1 my-2 rounded-lg",children:[n&&(0,x.jsx)("div",{children:(0,x.jsx)(o.Z,{width:24,height:24,src:n.avatar,name:n.name})}),(0,x.jsxs)("div",{className:"w-full flex flex-col",children:[(0,x.jsx)("div",{className:"flex items-center gap-2 font-semibold",children:(0,x.jsx)("span",{className:"text-gray-500 text-sm",children:(null===n||void 0===n?void 0:n.name)||"Deleted User"})}),(0,x.jsx)("div",{className:"select-text text-gray-500 text-sm break-all whitespace-pre-wrap dark:text-white",children:z({download:l,context:t,to:s,from_uid:r,content:i,content_type:c,properties:d,thumbnail:u})})]})]},a)}))})]}))}}),[m,t,s,r]),a?p:null};var p=s(84006),h=s(51091);const g=e=>{let{uploading:t,progress:s,thumbnail:r,download:a,content:n,properties:l}=e;const[o,c]=(0,i.useState)(r);return(0,i.useEffect)((()=>{const e=r,t=new Image;t.onload=()=>{c(e)},t.onerror=()=>{c("")},t.src=e}),[r]),(0,x.jsxs)("div",{className:"relative w-fit h-fit",children:[t&&(0,x.jsxs)("div",{className:"absolute left-0 top-0 w-full h-full bg-white/50 flex flex-col justify-center items-center gap-1",children:[(0,x.jsx)(h.Z,{size:45,speed:2,color:"#555"}),(0,x.jsxs)("span",{className:"text-xs text-gray-500",children:[s,"%"]})]}),(0,x.jsx)("img",{className:"w-full h-auto max-w-[480px] cursor-zoom-in object-cover preview","data-meta":JSON.stringify(l),"data-origin":n,"data-download":a,src:o})]})};var v=s(53517),w=s(1823),j=s(88332),b=s(66160);var y=s(34265),N=s(62432);const _=e=>{let{value:t,width:s="100%"}=e;return(0,x.jsx)("div",{className:"bg-[#ecfdff] rounded h-2 overflow-hidden",style:{width:s},children:(0,x.jsx)("div",{className:"h-2 bg-[#088ab2] rounded transition-all",style:{width:`${t}%`}})})};var L=s(11972),Z=s(24041),C=s(66673),E=s(8969);const $=e=>{let{url:t,name:s,size:r,download:a}=e;const[n,l]=(0,i.useState)(!1),[o,c]=(0,i.useState)(!1),u=(0,d.td)(r),f="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2";return(0,x.jsxs)("div",{className:"w-96 h-52 relative rounded-md border border-solid border-gray-300 overflow-hidden group",children:[(0,x.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-black/40 z-20 group-hover:hidden"}),(0,x.jsxs)("div",{className:"absolute top-0 left-0 w-full flex justify-between z-30 px-3 py-2 overflow-hidden group-hover:bg-black/20",children:[(0,x.jsxs)("div",{className:"flex gap-2 ",children:[(0,x.jsx)(E.Z,{className:"w-9 h-auto"}),(0,x.jsxs)("div",{className:"flex flex-col gap-1 text-sm text-white",children:[(0,x.jsx)("span",{title:s,className:"font-bold whitespace-nowrap text-ellipsis w-[240px] overflow-hidden",children:s}),(0,x.jsx)("span",{children:u})]})]}),(0,x.jsx)("a",{href:a,className:"mt-2",children:(0,x.jsx)(L.Z,{className:"fill-white"})})]}),n?o?(0,x.jsx)("span",{className:`${f} text-red-500`,children:"Error"}):null:(0,x.jsx)("div",{className:f,children:(0,x.jsx)(C.Z,{color:"#fff"})}),(0,x.jsx)("video",{onPlay:e=>{const t=e.currentTarget.previousSibling;t&&t.classList.add("hidden")},onError:()=>{l(!1),c(!0)},onCanPlay:()=>{l(!0)},onPause:e=>{const t=e.currentTarget.previousSibling;t&&t.classList.remove("hidden")},controls:n,className:"absolute left-0 top-0 w-full h-full object-cover z-10",children:(0,x.jsx)("source",{src:t,type:"video/mp4"})})]})};var k=s(20814),S=s(57425);const F=e=>{let{url:t,name:s,size:r,download:a}=e;const[n,l]=(0,i.useState)(!1),o=(0,d.td)(r);return(0,x.jsxs)("div",{className:"w-96 flex flex-col gap-2 px-3 py-2 rounded-md border border-solid border-gray-300 overflow-hidden bg-[#f1f3f4]",children:[(0,x.jsxs)("div",{className:"flex justify-between z-30 overflow-hidden",children:[(0,x.jsxs)("div",{className:"flex gap-2 ",children:[(0,x.jsx)(k.Z,{className:"w-9 h-auto"}),(0,x.jsxs)("div",{className:"flex flex-col gap-1 text-sm text-gray-700",children:[(0,x.jsx)("span",{title:s,className:"font-bold whitespace-nowrap text-ellipsis w-[240px] overflow-hidden",children:s}),(0,x.jsx)("span",{children:o})]})]}),(0,x.jsx)("a",{href:a,className:"mt-2",children:(0,x.jsx)(L.Z,{className:"download_icon gray"})})]}),(0,x.jsx)("audio",{src:t,onCanPlay:()=>{l(!0)},controls:!0,className:(0,S.Z)("w-full object-cover z-10",n?"":"hidden")})]})},O=e=>e.startsWith("blob:"),P=e=>{let{context:t,to:s,created_at:r,from_uid:n,content:l="",download:o="",thumbnail:c="",properties:u={local_id:0,name:"",size:0,content_type:""}}=e;const[f,m]=(0,i.useState)(null),[p,h]=(0,i.useState)(!1),C=function(e){let{context:t="user",id:s=0}=e;const r=(0,b.TL)(),a="channel"==t?w.nF:j.Fs;return e=>{r(a({id:s,mid:e})),r((0,v.Gd)(e))}}({context:t,id:s}),{sendMessage:E,isSuccess:k,isSending:P}=(0,N.Z)({context:t,from:n,to:s}),{stopUploading:R,data:z,uploadFile:M,progress:U,isSuccess:I}=(0,y.Z)(),T=(0,b.CG)((e=>e.users.byId[n])),{size:D=0,name:G,content_type:A}=null!==u&&void 0!==u?u:{};(0,i.useEffect)((()=>{O(l)&&(async e=>{let{url:t,name:s,type:r}=e;try{if(h(!0),r.startsWith("image")){const e=await(0,d.Ad)(t);m(e)}let e=await fetch(t).then((e=>e.blob())).then((e=>new File([e],s,{type:r})));await M(e),h(!1)}catch(a){h(!1)}})({url:l,name:G,type:A})}),[l,G,A]),(0,i.useEffect)((()=>{const e=null!==u&&void 0!==u?u:{},t=f?{...e,...f}:e;if(I&&O(l)){const{path:e}=z;E({ignoreLocal:!0,type:"file",content:{path:e},properties:t})}}),[I,z,u,l]),(0,i.useEffect)((()=>{k&&URL.revokeObjectURL(l)}),[k,l]);if(!u)return null;const H=(0,d.LP)(A,G,"w-9 h-auto");if(!l||!G)return null;const W=p||P;return(0,d.Or)(A,D)?(0,x.jsx)(g,{uploading:W,progress:U,properties:{...f,...u},content:l,download:o,thumbnail:c},null===u||void 0===u?void 0:u.local_id):A.startsWith("video")&&!W?(0,x.jsx)($,{size:D,url:l,name:G,download:o}):A.startsWith("audio")&&!W?(0,x.jsx)(F,{size:D,url:l,name:G,download:o}):(0,x.jsx)("div",{className:(0,S.Z)("file_message bg-slate-50 border border-solid border-gray-300 box-border w-[370px] h-[66px] rounded-md",W&&"opacity-90"),children:(0,x.jsxs)("div",{className:"p-2 flex items-center justify-between gap-2",children:[H,(0,x.jsxs)("div",{className:"flex flex-col gap-1 w-full overflow-hidden",children:[(0,x.jsx)("span",{className:"font-semibold text-sm text-gray-800 whitespace-nowrap text-ellipsis",children:G}),(0,x.jsx)("span",{className:"whitespace-nowrap text-xs text-gray-500 flex gap-4",children:W?(0,x.jsx)(_,{value:U,width:"80%"}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("i",{children:(0,d.td)(D)}),(0,x.jsx)("i",{children:a()(r).fromNow()}),T&&(0,x.jsxs)("i",{children:["by ",(0,x.jsx)("strong",{className:"font-bold",children:T.name})]})]})})]}),W?(0,x.jsx)(Z.Z,{className:"cursor-pointer",onClick:()=>{R(),URL.revokeObjectURL(l),C(u.local_id)}}):(0,x.jsx)("a",{className:"whitespace-nowrap",download:G,href:`${l}&download=true`,children:(0,x.jsx)(L.Z,{className:"fill-gray-500"})})]})})};var R=s(7935);const z=e=>{let{context:t,to:s=0,from_uid:r=0,created_at:i,properties:o,content_type:c,content:d,download:u,thumbnail:f,edited:h=!1}=e,g=null;switch(c){case l.bT.text:g=(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(R.Z,{text:d,cid:s}),h&&(0,x.jsxs)("span",{className:"ml-1 text-gray-500 text-[10px]",title:a()(+h).format("YYYY-MM-DD h:mm:ss A"),children:["(",n.ZP.t("edited",{ns:"chat"}),")"]})]});break;case l.bT.markdown:g=(0,x.jsx)(p.Z,{content:d});break;case l.bT.file:g=(0,x.jsx)(P,{properties:o,context:t,to:s,download:u,thumbnail:f,from_uid:r,created_at:i,content:d});break;case l.bT.archive:g=(0,x.jsx)(m,{properties:o,context:t,to:s,from_uid:r,created_at:i,id:d,thumbnail:f})}return g}},11855:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(70537),a=s(24783),n=s(66160);function l(e){let{cid:t=null,uid:s=null}=e;const[l]=(0,a.DJ)(),[i]=(0,a.mK)(),[o,c]=(0,r.useState)([]),{favs:d=[]}=(0,n.CG)((e=>({favs:e.favorites})));return(0,r.useEffect)((()=>{let e=[];e=t?d.filter((e=>!!e.messages&&e.messages.every((e=>e.source.gid==t)))):d,e=s?e.filter((e=>!!e.messages&&e.messages.every((e=>e.source.uid==s)))):e,c(e)}),[t,s,d]),{isFavorited:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!e)return!1;let t=[];return o.forEach((e=>{var s;if(1==(null===e||void 0===e||null===(s=e.messages)||void 0===s?void 0:s.length)){const s=e.messages.map((e=>e.from_mid));t=[...t,...s]}})),t.findIndex((t=>t==e))>-1},addFavorite:async e=>{const t=Array.isArray(e)?e.map((e=>+e)):[+e];if(0==t.length)return;return!("error"in await i(t))},removeFavorite:e=>{e&&l(e)},favorites:o}}},62432:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(27418),a=s(53517),n=s(6144),l=s(52334),i=s(24783),o=s(66160);const c=e=>{const{context:t="user",from:s=0,to:c=0}=e||{},d=(0,o.TL)(),u=(0,o.CG)((e=>e.ui.uploadFiles[`${t}_${c}`]||[])),[f,{isError:x,isLoading:m,isSuccess:p}]=(0,i.qt)(),[h,{isLoading:g,isSuccess:v,isError:w}]=(0,n.R4)(),[j,{isLoading:b,isSuccess:y,isError:N}]=(0,l.bm)(),_="user"==t?j:h,L=()=>{d((0,a.XS)(`${t}_${c}`))};return{setReplying:e=>{0===u.length?d((0,a.MQ)({mid:e,key:`${t}_${c}`})):r.ZP.error("Only text is supported when replying a message")},removeReplying:L,sendMessages:async e=>{let{type:t="text",content:s,users:r=[],channels:a=[]}=e;if(r.length)for await(const n of r)await j({type:t,id:n,content:s});if(a.length)for await(const n of a)await h({type:t,id:n,content:s})},sendMessage:async e=>{let{type:t="text",content:r="",properties:a,reply_mid:n,...l}=e;n?(L(),await f({from_uid:s,reply_mid:n,type:t,content:r,properties:a})):await _({id:c,content:r,properties:a,type:t,from_uid:s,...l})},isError:w||N||x,isSending:b||g||m,isSuccess:v||y||p}}},34265:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(70537),a=s(27418),n=s(12564),l=s(80308),i=s(24783),o=s(66160);const c=e=>{const{context:t,id:s}=e||{context:"channel",id:0},c=(0,o.TL)(),{stageFiles:d,replying:u}=(0,o.CG)((e=>({stageFiles:e.ui.uploadFiles[`${t}_${s}`]||[],replying:e.message.replying[`${t}_${s}`]}))),[f,x]=(0,r.useState)(null),m=(0,r.useRef)(!1),p=(0,r.useRef)(0),h=(0,r.useRef)(1),[g,{isLoading:v}]=(0,i.$_)(),[w,{isLoading:j,isError:b}]=(0,i.Yh)(),y=e=>{const{file_id:t,chunk:s,is_last:r}=e,a=new FormData;return a.append("file_id",t),a.append("chunk_data",s),a.append("chunk_is_last",`${r}`),w(a)};return{stopUploading:()=>{m.current=!0},data:f,isUploading:v||j,progress:+Number(p.current/h.current*100).toFixed(2),uploadFile:async e=>{if(!e)return;x(null);const{name:t=`-${+new Date}.${e.type.split("/")[1]}`,type:s,size:r}=e,n=await g({content_type:s,filename:t});if("error"in n)return void a.ZP.error("Prepare Upload File Error");const i=n.data;let o=null;if(m.current=!1,h.current=1,p.current=0,r<=2e6)o=await y({file_id:i,chunk:e,is_last:!0}),p.current=1;else{h.current=Math.ceil(r/l.Pb);const t=h.current,a=new Array(t);for await(const[r]of a.entries()){if(m.current)break;try{const t=e.slice(l.Pb*r,l.Pb*(r+1),s);o=await y({file_id:i,chunk:t,is_last:r==a.length-1}),p.current++}catch(w){return void(m.current=!0)}}}if(!o||"error"in o)return;const{path:c,size:d,hash:u}=o.data,f=encodeURIComponent(c),v={name:t,file_type:s,path:c,size:d,hash:u,url:`${l.ZP}/resource/file?file_path=${f}`,thumbnail:s.startsWith("image")?`${l.ZP}/resource/file?file_path=${f}&thumbnail=true`:"",download:`${l.ZP}/resource/file?file_path=${f}&download=true`};return x(v),v},isError:b,isSuccess:!!f,stageFiles:d,addStageFile:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u?a.ZP.error("Only text is supported when replying a message"):c((0,n.tD)({context:t,id:s,data:e}))},resetStageFiles:()=>{c((0,n.tD)({context:t,id:s,operation:"reset"}))},removeStageFile:e=>{c((0,n.tD)({context:t,id:s,operation:"remove",index:e}))},updateStageFile:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c((0,n.tD)({context:t,id:s,operation:"update",index:e,...r}))}}}}}]);