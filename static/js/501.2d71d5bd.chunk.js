"use strict";(globalThis.webpackChunkvocechat_web=globalThis.webpackChunkvocechat_web||[]).push([[501],{24041:(e,t,r)=>{r.d(t,{Z:()=>i});var s,n=r(70537);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},a.apply(this,arguments)}const l=(e,t)=>{let{title:r,titleId:l,...i}=e;return n.createElement("svg",a({width:16,height:16,viewBox:"0 0 16 16",fill:"#6C737F",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":l},i),r?n.createElement("title",{id:l},r):null,s||(s=n.createElement("path",{d:"M8.11904 0C3.91105 0 0.5 3.41105 0.5 7.61905C0.5 11.827 3.91105 15.2381 8.11904 15.2381C12.3271 15.2381 15.7381 11.827 15.7381 7.61905C15.7381 3.41105 12.3263 0 8.11904 0ZM11.7053 10.128L10.628 11.2053L8.11904 8.69714L5.61009 11.2053L4.53277 10.128L7.04095 7.61905L4.532 5.1101L5.60934 4.03353L8.11829 6.54248L10.6272 4.03353L11.7045 5.1101L9.19638 7.61905L11.7053 10.128Z"})))},i=(0,n.forwardRef)(l)},25552:(e,t,r)=>{r.d(t,{Z:()=>i});var s,n=r(70537);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},a.apply(this,arguments)}const l=(e,t)=>{let{title:r,titleId:l,...i}=e;return n.createElement("svg",a({width:14,height:15,viewBox:"0 0 14 15",fill:"black",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":l},i),r?n.createElement("title",{id:l},r):null,s||(s=n.createElement("path",{d:"M7 6.7929L10.5355 3.25736C10.7308 3.0621 11.0474 3.0621 11.2426 3.25736C11.4379 3.45262 11.4379 3.76921 11.2426 3.96447L7.70711 7.5L11.2426 11.0355C11.4379 11.2308 11.4379 11.5474 11.2426 11.7426C11.0474 11.9379 10.7308 11.9379 10.5355 11.7426L7 8.20711L3.46447 11.7426C3.26921 11.9379 2.95262 11.9379 2.75736 11.7426C2.5621 11.5474 2.5621 11.2308 2.75736 11.0355L6.2929 7.5L2.75736 3.96447C2.5621 3.76921 2.5621 3.45262 2.75736 3.25736C2.95262 3.0621 3.26921 3.0621 3.46447 3.25736L7 6.7929Z",fillOpacity:.8})))},i=(0,n.forwardRef)(l)},11972:(e,t,r)=>{r.d(t,{Z:()=>i});var s,n=r(70537);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},a.apply(this,arguments)}const l=(e,t)=>{let{title:r,titleId:l,...i}=e;return n.createElement("svg",a({width:24,height:24,viewBox:"0 0 24 24",fill:"#fff",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":l},i),r?n.createElement("title",{id:l},r):null,s||(s=n.createElement("path",{d:"M16.5303 11.7204L16.4462 11.6478C16.1526 11.4299 15.7359 11.4541 15.4697 11.7204L12.7503 14.4397L12.75 7.75003L12.7432 7.64826C12.6935 7.28218 12.3797 7.00003 12 7.00003L11.8982 7.00688C11.5322 7.05654 11.25 7.37033 11.25 7.75003L11.2503 14.4417L8.52961 11.7198L8.4455 11.6472C8.15193 11.4293 7.73527 11.4534 7.46895 11.7196C7.176 12.0124 7.17591 12.4873 7.46875 12.7803L11.4687 16.7818L11.5529 16.8544C11.8465 17.0724 12.2632 17.0482 12.5295 16.7819L16.5303 12.7811L16.6029 12.6969C16.8208 12.4033 16.7966 11.9867 16.5303 11.7204ZM6.25 3C4.45507 3 3 4.45507 3 6.25V17.75C3 19.5449 4.45507 21 6.25 21H17.75C19.5449 21 21 19.5449 21 17.75V6.25C21 4.45507 19.5449 3 17.75 3H6.25ZM4.5 6.25C4.5 5.2835 5.2835 4.5 6.25 4.5H17.75C18.7165 4.5 19.5 5.2835 19.5 6.25V17.75C19.5 18.7165 18.7165 19.5 17.75 19.5H6.25C5.2835 19.5 4.5 18.7165 4.5 17.75V6.25Z"})))},i=(0,n.forwardRef)(l)},10189:(e,t,r)=>{r.d(t,{Z:()=>i});var s,n=r(70537);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},a.apply(this,arguments)}const l=(e,t)=>{let{title:r,titleId:l,...i}=e;return n.createElement("svg",a({width:24,height:24,viewBox:"0 0 24 24",fill:"#667085",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":l},i),r?n.createElement("title",{id:l},r):null,s||(s=n.createElement("path",{d:"M14.2958 16.2945C13.9055 16.6853 13.906 17.3184 14.2968 17.7087C14.6876 18.0989 15.3207 18.0985 15.711 17.7077L20.7076 12.7043C21.0976 12.3137 21.0974 11.681 20.7072 11.2906L15.7106 6.29297C15.3201 5.9024 14.6869 5.90234 14.2964 6.29282C13.9058 6.6833 13.9057 7.31647 14.2962 7.70703L17.589 11H11C6.66509 11 3.13546 14.4478 3.00381 18.7508L3 19C3 19.5523 3.44772 20 4 20C4.55228 20 5 19.5523 5 19C5 15.7616 7.56557 13.1224 10.7751 13.0041L11 13H17.586L14.2958 16.2945Z"})))},i=(0,n.forwardRef)(l)},40760:(e,t,r)=>{r.d(t,{Z:()=>u});var s=r(70537),n=r(14566),a=r(18225),l=r(97943),i=r(81721),o=r(97601),c=r(80683);const d=e=>{let{download:t=!0,data:r,closeModal:d}=e;const{t:u}=(0,n.$G)(),[h,m]=(0,s.useState)(null===r||void 0===r?void 0:r.thumbnail),[f,p]=(0,s.useState)(!0),x=(0,s.useRef)(null);if((0,l.O)(x,d),(0,i.z)("Escape",(()=>{d()}),{eventTypes:["keyup"]}),(0,s.useEffect)((()=>{if(r){const{originUrl:e}=r;e||p(!1);const t=new Image;t.src=e,t.onload=()=>{m(e),p(!1)},t.onerror=()=>{p(!1)}}}),[r]),!r)return null;const{originUrl:g,downloadLink:v,name:w,type:b}=r;return(0,c.jsx)(o.Z,{children:(0,c.jsx)("div",{className:"w-screen h-screen flex-center bg-black/90",children:(0,c.jsxs)("div",{className:"relative flex flex-col justify-start gap-3",ref:x,children:[(0,c.jsx)("div",{className:"overflow-auto",children:(0,c.jsx)("img",{className:"max-w-[70vw] max-h-[80vh] "+(f?"blur-sm":""),src:h,alt:"preview"})}),t&&(0,c.jsx)("a",{className:"font-semibold text-sm text-gray-600 hover:underline hover:text-white",download:w,type:b,href:v||g,rel:"noreferrer",children:u("action.download_origin")}),f&&(0,c.jsx)("div",{className:"absolute top-[40%] left-1/2 -translate-x-1/2",children:(0,c.jsx)(a.Z,{})})]})})})},u=e=>{let{container:t,context:r="chat"}=e;const[n,a]=(0,s.useState)(null);return(0,s.useEffect)((()=>{if(!t)return;const e="chat"==r?e=>{const t=e.target;if(t&&"IMG"==t.nodeName&&t.classList.contains("preview")){const e=t.src,r=t.dataset.origin||t.src,s=t.dataset.download||t.src,n=JSON.parse(t.dataset.meta||"{}");a({thumbnail:e,originUrl:r,downloadLink:s,...n})}}:e=>{e.stopPropagation();const t=e.target;if(t&&"IMG"==t.nodeName){const e=new URL(t.src),r=`${e.origin}${e.pathname}?file_path=${e.searchParams.get("file_path")}`;a({originUrl:r})}};return t.addEventListener("click",e,!0),()=>{t.removeEventListener("click",e,!0)}}),[t,r]),n?(0,c.jsx)(d,{download:"chat"==r,data:n,closeModal:()=>{a(null)}}):null}},82493:(e,t,r)=>{r.d(t,{Z:()=>f});var s=r(24533),n=(r(34376),r(7829)),a=r(66160),l=r(62846),i=r(80683);const o=e=>{let{uid:t,popover:r=!0,cid:s,textOnly:o=!1}=e;const c=(0,a.CG)((e=>e.users.byId))[t];return c?o?(0,i.jsx)(i.Fragment,{children:`@${c.name}`}):r?(0,i.jsx)(n.ZP,{interactive:!0,placement:"top",trigger:"click",content:(0,i.jsx)(l.Z,{uid:t,type:"card",cid:s}),children:(0,i.jsx)("span",{className:"px-0.5 text-primary-400 cursor-pointer",children:`@${c.name}`})}):(0,i.jsx)("span",{className:"px-0.5 text-primary-400",children:`@${c.name}`}):null};var c=r(70537),d=r(3074),u=r(24783),h=r(81980);function m(e){let{url:t=""}=e;const r=(0,d.I0)(),[s,n]=(0,c.useState)(""),[l,{isLoading:o}]=(0,u.rf)(),m=(0,a.CG)((e=>e.footprint.og[t])),[f,p]=(0,c.useState)(null);(0,c.useEffect)((()=>{if(m){var e;let r="";try{r=`${new URL(t).origin}/favicon.ico`}catch{r=`${location.origin}/favicon.ico`}const s=(null===m||void 0===m?void 0:m.title)||(null===m||void 0===m?void 0:m.site_name)||"",a=(null===m||void 0===m?void 0:m.description)||"",l=(null===m||void 0===m||null===(e=m.images.find((e=>!!e.url)))||void 0===e?void 0:e.url)||"",i=(null===m||void 0===m?void 0:m.favicon_url)||r;n(i),p({title:s,description:a,ogImage:l})}else t&&l(t)}),[t,m]);if(o)return(0,i.jsx)("div",{className:"h-28"});if(!t||!f||!f.title)return null;const{title:x,description:g,ogImage:v}=f,w="flex items-center border border-solid border-gray-300 dark:border-gray-600 box-border rounded-md w-[80%] md:w-[380px]";return v?(0,i.jsxs)("a",{className:`${w} flex-col !items-start p-3`,href:t,target:"_blank",rel:"noreferrer",children:[(0,i.jsx)("h3",{className:"text-primary-500 w-full truncate",children:x}),(0,i.jsx)("p",{className:"text-xs text-gray-400 mb-2 w-full truncate",children:g}),(0,i.jsx)("div",{className:"w-full h-[180px]",children:(0,i.jsx)("img",{className:"w-full h-full object-cover",onError:()=>{r((0,h.P6)({key:t,value:{...m,images:[]}}))},src:v,alt:"og image"})})]}):(0,i.jsxs)("a",{className:`${w} gap-2  px-2 py-3`,href:t,target:"_blank",rel:"noreferrer",children:[s&&(0,i.jsx)("div",{className:"flex rounded",children:(0,i.jsx)("img",{className:"object-contain w-12 h-12",src:s,alt:"favicon"})}),(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("h3",{className:"text-sm text-gray-900 dark:text-gray-100",children:x}),(0,i.jsx)("p",{className:"hidden md:block text-xs text-gray-500 w-[288px] truncate",children:g}),(0,i.jsx)("span",{className:"text-[10px] text-gray-500 w-[288px] truncate",children:t})]})]})}const f=e=>{let{url:t=!0,mention:r=!0,mentionTextOnly:n=!1,mentionPopOver:a=!0,text:l,cid:c}=e;return(0,i.jsx)(s.Z,{options:{render:{email:e=>{let{content:t,attributes:{href:r}}=e;return n?(0,i.jsx)(i.Fragment,{children:t}):(0,i.jsx)("a",{className:"link",href:r,rel:"noreferrer",children:t})},url:e=>{let{content:r,attributes:{href:s}}=e;return t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("a",{className:"link",target:"_blank",href:s,rel:"noreferrer",children:r}),(0,i.jsx)(m,{url:s})]}):(0,i.jsx)(i.Fragment,{children:r})},mention:e=>{let{content:t}=e;if(!r)return(0,i.jsx)(i.Fragment,{children:t});if(/@[0-9]+/.test(t)){const e=t.trim().slice(1);return(0,i.jsx)(o,{uid:+e,cid:c,popover:a,textOnly:n})}return(0,i.jsx)(i.Fragment,{children:t})}}},children:l})}},22938:(e,t,r)=>{r.d(t,{Z:()=>d});var s=r(70537),n=(r(85012),r(55403)),a=r.n(n),l=r(51),i=(r(21504),r(69495),r(26602)),o=r(40760),c=r(80683);const d=e=>{let{content:t}=e;const r=(0,s.useRef)(null);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(o.Z,{container:r.current,context:"markdown"}),(0,c.jsx)("div",{ref:r,id:"MARKDOWN_CONTAINER",children:(0,c.jsx)(l.A,{initialValue:t,plugins:[a()],theme:(0,i.Yc)()?"dark":"light"})})]})}},60470:(e,t,r)=>{r.d(t,{Z:()=>ee});var s=r(18541),n=r(7699),a=r.n(n),l=r(80308),i=r(70537),o=r(57425),c=r(66160),d=r(53517),u=r(1823),h=r(88332);var m=r(75790),f=r(73395),p=r(26602),x=r(24041),g=r(11972),v=r(20814),w=r(80683);const b=e=>{let{url:t,name:r,size:s,download:n}=e;const[a,l]=(0,i.useState)(!1),c=(0,p.td)(s);return(0,w.jsxs)("div",{className:"md:w-96 flex flex-col gap-2 px-3 py-2 rounded-md border border-solid border-gray-300 dark:border-gray-500 overflow-hidden bg-stone-100 dark:bg-stone-900",children:[(0,w.jsxs)("div",{className:"flex justify-between z-30 overflow-hidden",children:[(0,w.jsxs)("div",{className:"flex gap-2 ",children:[(0,w.jsx)(v.Z,{className:"w-9 h-auto"}),(0,w.jsxs)("div",{className:"flex flex-col gap-1 text-sm text-gray-700 dark:text-gray-300",children:[(0,w.jsx)("span",{title:r,className:"font-bold w-[240px] truncate",children:r}),(0,w.jsx)("span",{children:c})]})]}),(0,w.jsx)("a",{href:n,className:"mt-2 hidden md:block",children:(0,w.jsx)(g.Z,{className:"fill-gray-500 dark:fill-gray-400"})})]}),(0,w.jsx)("audio",{src:t,onCanPlay:()=>{l(!0)},controls:!0,className:(0,o.Z)("w-full object-cover z-10",a?"visible":"invisible")})]})};var y=r(51091),j=r(21798);const N=e=>{let{uploading:t,progress:r,thumbnail:s,download:n,content:a,properties:l}=e;const o=s||a,[c,d]=(0,i.useState)("loading"),{width:u=0,height:h=0}=(0,p.CW)(l,{min:200,max:(0,p.tq)()?300:480});return(0,i.useEffect)((()=>{const e=new Image;e.onload=()=>{d("loaded")},e.onerror=()=>{d("error")},e.src=o}),[o]),(0,w.jsxs)("div",{className:"relative overflow-hidden",style:{width:u?`${u}px`:"",height:h?`${h}px`:""},children:[t&&(0,w.jsxs)("div",{className:"absolute left-0 top-0 w-full h-full bg-white/50 flex flex-col justify-center items-center gap-1",children:[(0,w.jsx)(y.Z,{size:45,speed:2,color:"#555"}),(0,w.jsxs)("span",{className:"text-xs text-gray-500",children:[r,"%"]})]}),"error"==c?(0,w.jsx)("p",{className:"w-full h-full flex-center text-lg text-red-800 bg-red-100",children:"load image error"}):"loading"==c?(0,w.jsx)("p",{className:"w-full h-full flex-center bg-primary-50/80 dark:bg-primary-900/70",children:(0,w.jsx)(j.Z,{})}):(0,w.jsx)("img",{className:"h-auto w-full cursor-zoom-in object-cover preview","data-meta":JSON.stringify(l),"data-origin":a,"data-download":n,src:o})]})},k=e=>{let{value:t,width:r="100%"}=e;return(0,w.jsx)("div",{className:"bg-gray-50 rounded h-2 overflow-hidden",style:{width:r},children:(0,w.jsx)("div",{className:"h-2 bg-primary-700 rounded transition-all",style:{width:`${t}%`}})})};var L=r(66673),C=r(8969);const _=e=>{let{url:t,name:r,size:s,download:n}=e;const[a,l]=(0,i.useState)(!1),[o,c]=(0,i.useState)(!1),d=(0,p.td)(s),u="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2";return(0,w.jsxs)("div",{className:"w-60 h-32 md:w-96 md:h-52 relative rounded-md border border-solid border-gray-300 dark:border-gray-700 overflow-hidden group",children:[(0,w.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-black/40 z-20 group-hover:hidden"}),(0,w.jsxs)("div",{className:"absolute top-0 left-0 w-full flex justify-between z-30 px-3 py-2 overflow-hidden group-hover:bg-black/20",children:[(0,w.jsxs)("div",{className:"flex gap-2 ",children:[(0,w.jsx)(C.Z,{className:"hidden md:block w-9 h-auto"}),(0,w.jsxs)("div",{className:"flex flex-col gap-1 text-sm text-white",children:[(0,w.jsx)("span",{title:r,className:"font-bold w-56 md:w-[240px] truncate",children:r}),(0,w.jsx)("span",{children:d})]})]}),(0,w.jsx)("a",{href:n,className:"hidden md:block mt-2",children:(0,w.jsx)(g.Z,{className:"fill-white"})})]}),a?o?(0,w.jsx)("span",{className:`${u} text-red-500`,children:"Error"}):null:(0,w.jsx)("div",{className:u,children:(0,w.jsx)(L.Z,{color:"#fff"})}),(0,w.jsx)("video",{onPlay:e=>{const t=e.currentTarget.previousSibling;t&&t.classList.add("hidden")},onError:()=>{l(!1),c(!0)},onCanPlay:()=>{l(!0)},onPause:e=>{const t=e.currentTarget.previousSibling;t&&t.classList.remove("hidden")},controls:a,className:"absolute left-0 top-0 w-full h-full object-cover z-10",children:(0,w.jsx)("source",{src:t,type:"video/mp4"})})]})},E=e=>e.startsWith("blob:"),Z=e=>{let{context:t,to:r,created_at:s,from_uid:n,content:a="",download:l="",thumbnail:v="",properties:y={local_id:0,name:"",size:0,content_type:""}}=e;const[j,L]=(0,i.useState)(null),[C,Z]=(0,i.useState)(!1),O=function(e){let{context:t="dm",id:r=0}=e;const s=(0,c.TL)(),n="channel"==t?u.nF:h.Fs;return e=>{s(n({id:r,mid:e})),s((0,d.Gd)(e))}}({context:t,id:r}),{sendMessage:S,isSuccess:$,isSending:M}=(0,m.Z)({context:t,from:n,to:r}),{stopUploading:P,data:F,uploadFile:R,progress:I,isSuccess:z,isError:U}=(0,f.Z)(),A=(0,c.CG)((e=>e.users.byId[n])),{size:T=0,name:D,content_type:G}=null!==y&&void 0!==y?y:{};(0,i.useEffect)((()=>{E(a)&&(async e=>{let{url:t,name:r,type:s}=e;try{if(Z(!0),s.startsWith("image")){const e=await(0,p.Ad)(t);L(e)}let e=await fetch(t).then((e=>e.blob())).then((e=>new File([e],r,{type:s})));await R(e),Z(!1)}catch(n){Z(!1),console.error("fetch local file error",n)}})({url:a,name:D,type:G})}),[a,D,G]);const B=()=>{P(),URL.revokeObjectURL(a),O(y.local_id)};if((0,i.useEffect)((()=>{U&&B()}),[U]),(0,i.useEffect)((()=>{const e=null!==y&&void 0!==y?y:{},t=j?{...e,...j}:e;if(z&&E(a)){const{path:e}=F;S({ignoreLocal:!0,type:"file",content:{path:e},properties:t})}}),[z,F,y,a]),(0,i.useEffect)((()=>{$&&URL.revokeObjectURL(a)}),[$,a]),!y)return null;const W=(0,p.LP)(G,D,"w-9 h-auto");if(!a||!D)return null;const V=C||M;return(0,p.Or)(G,T)?(0,w.jsx)(N,{uploading:V,progress:I,properties:{...j,...y},content:a,download:l,thumbnail:v},null===y||void 0===y?void 0:y.local_id):G.startsWith("video")&&!V?(0,w.jsx)(_,{size:T,url:a,name:D,download:l}):G.startsWith("audio")&&!V?(0,w.jsx)(b,{size:T,url:a,name:D,download:l}):(0,w.jsx)("div",{className:(0,o.Z)("bg-slate-50 dark:bg-slate-900 border border-solid border-gray-300 dark:border-gray-500 box-border md:w-[370px] rounded-md",V&&"opacity-90"),children:(0,w.jsxs)("div",{className:"px-2 py-3 flex items-center justify-between gap-2",children:[W,(0,w.jsxs)("div",{className:"flex flex-col gap-1 w-full overflow-hidden",children:[(0,w.jsx)("span",{className:"font-semibold text-sm text-gray-800 dark:text-gray-100 truncate",children:D}),(0,w.jsx)("span",{className:"hidden md:flex whitespace-nowrap text-xs text-gray-500 dark:text-gray-300 gap-4",children:V?(0,w.jsx)(k,{value:I,width:"80%"}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("strong",{children:(0,p.td)(T)}),(0,w.jsx)("strong",{children:(0,p.Lf)(s)}),A&&(0,w.jsxs)("strong",{children:["by ",(0,w.jsx)("strong",{className:"font-bold",children:A.name})]})]})})]}),V?(0,w.jsx)(x.Z,{className:"cursor-pointer",onClick:B}):(0,w.jsx)("a",{className:"hidden md:block whitespace-nowrap",download:D,href:`${a}&download=true`,children:(0,w.jsx)(g.Z,{className:"fill-gray-500 dark:fill-gray-400"})})]})})};var O,S=r(82493),$=r(22938),M=r(23763),P=r.n(M);function F(){return F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},F.apply(this,arguments)}const R=(e,t)=>{let{title:r,titleId:s,...n}=e;return i.createElement("svg",F({width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"#101828",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":s},n),r?i.createElement("title",{id:s},r):null,O||(O=i.createElement("path",{d:"M10 15V9M14 15V9M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})))},I=(0,i.forwardRef)(R);var z,U;function A(){return A=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},A.apply(this,arguments)}const T=(e,t)=>{let{title:r,titleId:s,...n}=e;return i.createElement("svg",A({width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"#101828",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":s},n),r?i.createElement("title",{id:s},r):null,z||(z=i.createElement("path",{d:"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})),U||(U=i.createElement("path",{d:"M10 8L16 12L10 16V8Z",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})))},D=(0,i.forwardRef)(T);var G;function B(){return B=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},B.apply(this,arguments)}const W=(e,t)=>{let{title:r,titleId:s,...n}=e;return i.createElement("svg",B({width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"#101828",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":s},n),r?i.createElement("title",{id:s},r):null,G||(G=i.createElement("path",{d:"M23 3.99995V9.99995M23 9.99995H17M23 9.99995L18.36 5.63995C17.2853 4.56467 15.9556 3.77916 14.4952 3.35673C13.0348 2.93429 11.4911 2.8887 10.0083 3.22421C8.52547 3.55972 7.1518 4.26539 6.01547 5.27537C4.87913 6.28536 4.01717 7.56674 3.51 8.99995M1 20V14M1 14H7M1 14L5.64 18.36C6.71475 19.4352 8.04437 20.2207 9.50481 20.6432C10.9652 21.0656 12.5089 21.1112 13.9917 20.7757C15.4745 20.4402 16.8482 19.7345 17.9845 18.7245C19.1209 17.7145 19.9828 16.4332 20.49 15",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})))},V=(0,i.forwardRef)(W),H={},Y=e=>{let{file_path:t}=e;const r=(0,i.useRef)(null),[s,n]=(0,i.useState)("loading"),[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)(""),m=e=>{var t;let s=null;const i=`${l.ZP}/resource/file?file_path=${encodeURIComponent(e)}`;s=P().create({container:null!==(t=r.current)&&void 0!==t?t:"",height:32,waveColor:"#0BA5EC",cursorColor:"#0BA5AA",progressColor:"#0BA5AA",hideScrollbar:!0,normalize:!0,responsive:!0}),s.load(i),s.on("error",(function(t){n("error");const r=H[e];r&&r.destroy()})),s.on("play",(function(){d(!0)})),s.on("pause",(function(){d(!1)})),s.on("ready",(function(){n("ready");const t=H[e];if(t){const e=t.getDuration(),r=Math.ceil(e),s=a().duration(r,"seconds").format("mm:ss");h(s)}if(r.current){var s;const e=r.current,t=null===(s=e.querySelector("wave>canvas"))||void 0===s?void 0:s.width;e.style.width=`${t}px`}})),H[e]=s};(0,i.useEffect)((()=>(r.current&&t&&m(t),()=>{const e=H[t];e&&e.destroy()})),[t]);const f="ready"!==s;return(0,w.jsxs)("div",{className:(0,o.Z)("relative whitespace-nowrap select-none flex items-center gap-2 p-2 rounded-lg max-w-sm","error"===s?"bg-red-200":"bg-primary-100 dark:bg-primary-900"),children:[(0,w.jsx)("button",{className:"disabled:opacity-60",onClick:()=>{const e=H[t];e&&(e.isPlaying()||Object.keys(H).forEach((e=>{try{const t=H[e];t&&t.backend&&t.isPlaying()&&t.stop()}catch(t){}})),e.playPause())},disabled:f,children:c?(0,w.jsx)(I,{className:"stroke-primary-500"}):(0,w.jsx)(D,{className:"stroke-primary-500"})}),(0,w.jsxs)("div",{ref:r,className:(0,o.Z)("flex-1 h-8 min-w-[100px]"),children:["loading"==s&&(0,w.jsx)("span",{className:"text-xs",children:"Loading voice message..."}),"error"==s&&(0,w.jsx)("span",{className:"text-xs text-red-800",children:"Load voice message error"})]}),"error"!==s&&(0,w.jsx)("time",{className:"text-primary-500 text-xs whitespace-nowrap text-left",children:u}),"error"===s&&(0,w.jsx)(V,{role:"button",className:"absolute -right-6 top-1/2 -translate-y-1/2 w-4 h-4 stroke-primary-600",onClick:()=>{m(t)}})]})};var q=r(14566),J=r(24783);var K=r(10189),Q=r(16956);const X=e=>{let{context:t,to:r,from_uid:s,id:n}=e;const{t:a}=(0,q.$G)(),{messages:l,isLoading:o}=function(e){const t=(0,c.CG)((t=>t.archiveMessage[null!==e&&void 0!==e?e:""])),[r,s]=(0,i.useState)(null),[n,{isError:a,isLoading:l,isSuccess:o}]=(0,J.uv)();return(0,i.useEffect)((()=>{if(t){const r=(0,p.Hr)(t,e);s(r)}else e&&n(e)}),[t,e]),{messages:r,isError:a,isLoading:l,isSuccess:o}}(n),[d,u]=(0,i.useState)(null);return(0,i.useEffect)((()=>{if(l){const e=l.map((e=>{let{from_mid:t}=e;return t}))||[];u((0,w.jsxs)("div",{"data-forwarded-mids":e.join(","),className:"flex flex-col text-left rounded-lg bg-gray-200 dark:bg-gray-900",children:[(0,w.jsxs)("h4",{className:"p-2 pb-0 flex items-center gap-1 text-gray-500 text-xs",children:[(0,w.jsx)(K.Z,{className:"w-4 h-4 fill-gray-500"}),a("action.forward")]}),(0,w.jsx)("div",{className:"list",children:l.map(((e,n)=>{const{user:a={},download:l,content:i,content_type:o,properties:c,thumbnail:d}=e;return(0,w.jsxs)("div",{className:"w-full relative flex items-start gap-4 px-2 py-1 my-2 rounded-lg",children:[a&&(0,w.jsx)("div",{className:"w-6 h-6 rounded-full flex shrink-0 overflow-hidden",children:(0,w.jsx)(Q.Z,{width:24,height:24,src:a.avatar,name:a.name})}),(0,w.jsxs)("div",{className:"w-full flex flex-col",children:[(0,w.jsx)("div",{className:"flex items-center gap-2 font-semibold",children:(0,w.jsx)("span",{className:"text-gray-500 text-sm",children:(null===a||void 0===a?void 0:a.name)||"Deleted User"})}),(0,w.jsx)("div",{className:"select-text text-gray-500 text-sm break-all whitespace-pre-wrap dark:text-white",children:ee({download:l,context:t,to:r,from_uid:s,content:i,content_type:o,properties:c,thumbnail:d})})]})]},n)}))})]}))}}),[l,t,r,s]),n?o?(0,w.jsx)("span",{className:"text-sm dark:text-white",children:"Loading"}):d:null},ee=e=>{let{context:t,to:r=0,from_uid:n=0,created_at:i,properties:o,content_type:c,content:d,download:u,thumbnail:h,edited:m=!1}=e,f=null;switch(c){case l.bT.text:f=(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(S.Z,{text:d,cid:r}),m&&(0,w.jsxs)("span",{className:"ml-1 text-gray-500 text-[10px]",title:a()(+m).format("YYYY-MM-DD h:mm:ss A"),children:["(",s.ZP.t("edited",{ns:"chat"}),")"]})]});break;case l.bT.markdown:f=(0,w.jsx)($.Z,{content:d});break;case l.bT.audio:f=(0,w.jsx)(Y,{file_path:d});break;case l.bT.file:f=(0,w.jsx)(Z,{properties:o,context:t,to:r,download:u,thumbnail:h,from_uid:n,created_at:i,content:d});break;case l.bT.archive:f=(0,w.jsx)(X,{properties:o,context:t,to:r,from_uid:n,created_at:i,id:d,thumbnail:h})}return f}},97601:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(70537),n=r(10336);const a=e=>{let{id:t="root-modal",mask:r=!0,children:a}=e;const[l,i]=(0,s.useState)(null);return(0,s.useEffect)((()=>{const e=document.getElementById(t);if(!e)return;r&&e.classList.add("mask");const s=document.createElement("div");return s.classList.add("wrapper"),e.appendChild(s),i(s),()=>{e.removeChild(s)}}),[t,r]),l?(0,n.createPortal)(a,l):null}},2632:(e,t,r)=>{r.d(t,{Z:()=>l});var s=r(70537),n=r(24783),a=r(66160);function l(e){let{cid:t=null,uid:r=null}=e;const[l]=(0,n.DJ)(),[i]=(0,n.mK)(),[o,c]=(0,s.useState)([]),{favs:d=[]}=(0,a.CG)((e=>({favs:e.favorites})));return(0,s.useEffect)((()=>{let e=[];e=t?d.filter((e=>!!e.messages&&e.messages.every((e=>e.source.gid==t)))):d,e=r?e.filter((e=>!!e.messages&&e.messages.every((e=>e.source.uid==r)))):e,c(e)}),[t,r,d]),{isFavorited:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!e)return!1;let t=[];return o.forEach((e=>{var r;if(1==(null===e||void 0===e||null===(r=e.messages)||void 0===r?void 0:r.length)){const r=e.messages.map((e=>e.from_mid));t=[...t,...r]}})),t.findIndex((t=>t==e))>-1},addFavorite:async e=>{const t=Array.isArray(e)?e.map((e=>+e)):[+e];if(0==t.length)return;return!("error"in await i(t))},removeFavorite:e=>{e&&l(e)},favorites:o}}},75790:(e,t,r)=>{r.d(t,{Z:()=>c});var s=r(27418),n=r(6144),a=r(24783),l=r(52334),i=r(53517),o=r(66160);const c=e=>{const{context:t="dm",from:r=0,to:c=0}=e||{},d=(0,o.TL)(),u=(0,o.CG)((e=>e.ui.uploadFiles[`${t}_${c}`]||[])),[h,{isError:m,isLoading:f,isSuccess:p}]=(0,a.qt)(),[x,{isLoading:g,isSuccess:v,isError:w}]=(0,n.R4)(),[b,{isLoading:y,isSuccess:j,isError:N}]=(0,l.bm)(),k="dm"==t?b:x,L=()=>{d((0,i.XS)(`${t}_${c}`))};return{setReplying:e=>{0===u.length?d((0,i.MQ)({mid:e,key:`${t}_${c}`})):s.ZP.error("Only text is supported when replying a message")},removeReplying:L,sendMessages:async e=>{let{type:t="text",content:r,users:s=[],channels:n=[]}=e;if(s.length)for await(const a of s)await b({type:t,id:a,content:r});if(n.length)for await(const a of n)await x({type:t,id:a,content:r})},sendMessage:async e=>{let{type:t="text",content:s="",properties:n,reply_mid:a,...l}=e;a?(L(),await h({from_uid:r,reply_mid:a,type:t,content:s,properties:n})):await k({id:c,content:s,properties:n,type:t,from_uid:r,...l})},isError:w||N||m,isSending:y||g||f,isSuccess:v||j||p}}},73395:(e,t,r)=>{r.d(t,{Z:()=>c});var s=r(70537),n=r(27418),a=r(80308),l=r(24783),i=r(12564),o=r(66160);const c=e=>{const{context:t,id:r}=e||{context:"channel",id:0},c=(0,o.TL)(),{stageFiles:d,replying:u}=(0,o.CG)((e=>({stageFiles:e.ui.uploadFiles[`${t}_${r}`]||[],replying:e.message.replying[`${t}_${r}`]}))),[h,m]=(0,s.useState)(null),f=(0,s.useRef)(!1),p=(0,s.useRef)(0),x=(0,s.useRef)(1),[g,{isLoading:v,isError:w}]=(0,l.$_)(),[b,{isLoading:y,isError:j}]=(0,l.Yh)(),N=e=>{const{file_id:t,chunk:r,is_last:s}=e,n=new FormData;return n.append("file_id",t),n.append("chunk_data",r),n.append("chunk_is_last",`${s}`),b(n)};return{stopUploading:()=>{f.current=!0},data:h,isUploading:v||y,progress:+Number(p.current/x.current*100).toFixed(2),uploadFile:async e=>{if(!e)return;m(null);const{name:t=`-${+new Date}.${e.type.split("/")[1]}`,type:r,size:s}=e,n=await g({content_type:r,filename:t});if("error"in n)return;const l=n.data;let i=null;if(f.current=!1,x.current=1,p.current=0,s<=2e6)i=await N({file_id:l,chunk:e,is_last:!0}),p.current=1;else{x.current=Math.ceil(s/a.Pb);const t=x.current,n=new Array(t);for await(const[s]of n.entries()){if(f.current)break;try{const t=e.slice(a.Pb*s,a.Pb*(s+1),r);i=await N({file_id:l,chunk:t,is_last:s==n.length-1}),p.current++}catch(v){return console.error("upload file error",v),void(f.current=!0)}}}if(!i||"error"in i)return;const{path:o,size:c,hash:d}=i.data,u=encodeURIComponent(o),h={name:t,file_type:r,path:o,size:c,hash:d,url:`${a.ZP}/resource/file?file_path=${u}`,thumbnail:r.startsWith("image")?`${a.ZP}/resource/file?file_path=${u}&thumbnail=true`:"",download:`${a.ZP}/resource/file?file_path=${u}&download=true`};return m(h),h},isError:j||w,isSuccess:!!h,stageFiles:d,addStageFile:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u?n.ZP.error("Only text is supported when replying a message"):c((0,i.tD)({context:t,id:r,data:e}))},resetStageFiles:()=>{c((0,i.tD)({context:t,id:r,operation:"reset"}))},removeStageFile:e=>{c((0,i.tD)({context:t,id:r,operation:"remove",index:e}))},updateStageFile:function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c((0,i.tD)({context:t,id:r,operation:"update",index:e,...s}))}}}}}]);