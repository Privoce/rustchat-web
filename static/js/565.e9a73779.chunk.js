"use strict";(globalThis.webpackChunkvocechat_web=globalThis.webpackChunkvocechat_web||[]).push([[565],{53878:(e,s,t)=>{t.d(s,{Z:()=>r});var c=t(70537),i=t(65809),n=t(66160);const r=function(){var e;let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{userCount:t,isGuest:r,upgraded:a}=(0,n.CG)((e=>({userCount:e.users.ids.length,isGuest:e.authData.guest,upgraded:e.server.upgraded}))),{data:o,refetch:l,isLoading:d}=(0,i.qM)(void 0,{refetchOnMountOrArgChange:s,skip:r}),[u,{isLoading:g,isSuccess:h}]=(0,i.U_)(),[p,{isSuccess:f,isLoading:x,reset:m}]=(0,i.yn)();(0,c.useEffect)((()=>{f&&(l(),m())}),[f]);return{upgraded:a,reachLimit:t>=(null!==(e=null===o||void 0===o?void 0:o.user_limit)&&void 0!==e?e:Number.MAX_SAFE_INTEGER),license:o,checked:h,isLoading:d,checking:g,upserting:x,upserted:f,checkLicense:e=>{u(e)},upsertLicense:async e=>{const s=await u(e);return!(!("data"in s)||!s.data.sign)&&await p(e)}}}},19565:(e,s,t)=>{t.r(s),t.d(s,{default:()=>x});var c=t(15924),i=t(70537),n=t(27418),r=t(14566),a=t(80308),o=t(15312),l=t(4472),d=t(80683);const u=e=>{let{code:s,from:t="webapp"}=e;const{t:c}=(0,r.$G)("auth"),{t:u}=(0,r.$G)(),g=localStorage.getItem(a.LJ),[h,{isLoading:p,isSuccess:f,error:x}]=(0,o.YA)();(0,i.useEffect)((()=>{s&&h({magic_token:g,code:s,type:"github"})}),[s]),(0,i.useEffect)((()=>{f&&(n.ZP.success(u("tip.login")),"widget"==t&&localStorage.setItem("widget",`${(new Date).getTime()}`),"webapp"==t&&(location.href="/"))}),[f,t]),(0,i.useEffect)((()=>{if(x)if(410===x.status)n.ZP.error("No associated account found, please contact user admin for an invitation link to join.");else n.ZP.error("Something Error")}),[x]);return x?(0,d.jsx)("span",{className:"text-red-500 text-lg",children:"Something Error"}):(0,d.jsxs)("section",{className:"flex-center flex-col gap-3",children:[(0,d.jsx)(l.Z,{onClick:()=>{window.close()},children:u("action.close")}),f&&"widget"==t&&(0,d.jsx)("h1",{children:c("github_cb_tip")}),(0,d.jsx)("span",{className:"text-3xl text-green-600 font-bold",children:c(p?"github_logging_in":"github_login_success")})]})};var g=t(65809),h=t(53878);const p=e=>{let{sid:s}=e;const{t:t}=(0,r.$G)("setting",{keyPrefix:"license"}),n=(0,c.s0)(),{upsertLicense:a,upserting:o,upserted:u}=(0,h.Z)(),[p,{data:f,isError:x,isLoading:m,isSuccess:b}]=(0,g.YS)();(0,i.useEffect)((()=>{s&&p(s)}),[s]),(0,i.useEffect)((()=>{if(b&&f){const e=f.license;a(e)}}),[f,b]);return(0,d.jsxs)("section",{className:"flex flex-col items-center bg-slate-100 dark:bg-slate-800 rounded-2xl w-4/5 md:w-[512px] p-6",children:[(0,d.jsx)("img",{className:"w-28 h-28",src:"https://s.voce.chat/web_client/assets/img/check.png",alt:"check icon"}),(0,d.jsx)("h1",{className:"font-bold text-3xl pt-5",children:t("payment_success")}),(0,d.jsxs)("p",{className:"text-lg pb-7 mt-2 text-gray-400 dark:text-gray-600",children:[o?t("tip_renewing"):"",u?t("tip_renewed"):"",x?t("tip_renew_error"):""]}),(0,d.jsx)(l.Z,{disabled:m||o,className:"back",onClick:()=>{n("/")},children:t("back_home")})]})},f=e=>{let{children:s}=e;return(0,d.jsx)("div",{className:"flex-center dark:bg-gray-700 dark:text-white w-screen h-screen break-words leading-normal",children:s})};function x(){const{type:e="",payload:s=""}=(0,c.UO)();if("payment_success"==e)return(0,d.jsx)(f,{children:(0,d.jsx)(p,{sid:s})});if("github"==e){var t;const e=null!==(t=new URLSearchParams(location.search).get("code"))&&void 0!==t?t:"";return(0,d.jsx)(f,{children:(0,d.jsx)(u,{code:e,from:s})})}return(0,d.jsx)(f,{children:"callback page"})}}}]);