"use strict";(globalThis.webpackChunkvocechat_web=globalThis.webpackChunkvocechat_web||[]).push([[741],{38761:(e,t,i)=>{i.d(t,{Z:()=>r});var n,a=i(70537);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},o.apply(this,arguments)}const l=({title:e,titleId:t,...i},l)=>a.createElement("svg",o({width:24,height:24,viewBox:"0 0 24 24",fill:"white",xmlns:"http://www.w3.org/2000/svg",ref:l,"aria-labelledby":t},i),e?a.createElement("title",{id:t},e):null,n||(n=a.createElement("path",{d:"M21.7806 2.21967C22.0735 2.51256 22.0735 2.98744 21.7806 3.28033L18.5609 6.5L21.7806 9.71967C22.0735 10.0126 22.0735 10.4874 21.7806 10.7803C21.4877 11.0732 21.0128 11.0732 20.7199 10.7803L17.5002 7.56066L14.2806 10.7803C13.9877 11.0732 13.5128 11.0732 13.2199 10.7803C12.927 10.4874 12.927 10.0126 13.2199 9.71967L16.4396 6.5L13.2199 3.28033C12.927 2.98744 12.927 2.51256 13.2199 2.21967C13.5128 1.92678 13.9877 1.92678 14.2806 2.21967L17.5002 5.43934L20.7199 2.21967C21.0128 1.92678 21.4877 1.92678 21.7806 2.21967ZM9.36737 3.31232L10.2271 5.33967C10.6018 6.22312 10.3939 7.26203 9.71313 7.90815L7.81881 9.70616C7.93569 10.7816 8.2972 11.8406 8.90334 12.8832C9.50948 13.9257 10.2665 14.7905 11.1744 15.4776L13.4496 14.7189C14.312 14.4313 15.2512 14.7618 15.7802 15.539L17.0125 17.3495C17.6275 18.2529 17.5169 19.4993 16.7538 20.2653L15.9361 21.0862C15.1222 21.9033 13.9597 22.1997 12.8843 21.8643C10.3454 21.0723 8.01109 18.7211 5.88132 14.8107C3.74845 10.8945 2.9957 7.57189 3.62307 4.84289C3.88707 3.69457 4.70458 2.78009 5.77209 2.43899L6.84868 2.09498C7.8575 1.77263 8.93535 2.29358 9.36737 3.31232Z"}))),r=(0,a.forwardRef)(l)},97655:(e,t,i)=>{i.d(t,{Z:()=>r});var n,a=i(70537);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},o.apply(this,arguments)}const l=({title:e,titleId:t,...i},l)=>a.createElement("svg",o({width:24,height:24,viewBox:"0 0 24 24",fill:"#70707B",xmlns:"http://www.w3.org/2000/svg",ref:l,"aria-labelledby":t},i),e?a.createElement("title",{id:t},e):null,n||(n=a.createElement("path",{d:"M7.7716 2.43923L8.84819 2.09522C9.85701 1.77287 10.9349 2.29382 11.3669 3.31256L12.2266 5.33991C12.6013 6.22336 12.3934 7.26227 11.7126 7.9084L9.81832 9.70641C9.9352 10.7819 10.2967 11.8409 10.9029 12.8834C11.509 13.9259 12.266 14.7907 13.1739 15.4778L15.4491 14.7191C16.3115 14.4315 17.2507 14.762 17.7797 15.5392L19.0121 17.3498C19.627 18.2532 19.5164 19.4995 18.7534 20.2655L17.9356 21.0865C17.1217 21.9036 15.9592 22.2 14.8838 21.8645C12.3449 21.0726 10.0106 18.7214 7.88083 14.8109C5.74796 10.8947 4.99521 7.57214 5.62258 4.84313C5.88658 3.69482 6.70409 2.78033 7.7716 2.43923Z"}))),r=(0,a.forwardRef)(l)},18697:(e,t,i)=>{i.d(t,{Z:()=>s});var n,a,o=i(70537);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},l.apply(this,arguments)}const r=({title:e,titleId:t,...i},r)=>o.createElement("svg",l({width:16,height:12,viewBox:"0 0 16 12",fill:"#78787C",xmlns:"http://www.w3.org/2000/svg",ref:r,"aria-labelledby":t},i),e?o.createElement("title",{id:t},e):null,n||(n=o.createElement("g",{clipPath:"url(#clip0_9046_23916)"},o.createElement("path",{d:"M4.93942 9.69781L1.62578 6.38648C1.25336 6.01431 0.651746 6.01431 0.27932 6.38648C-0.0931066 6.75865 -0.0931066 7.35984 0.27932 7.73201L4.27096 11.7209C4.64339 12.093 5.245 12.093 5.61743 11.7209L15.7207 1.62465C16.0931 1.25248 16.0931 0.651292 15.7207 0.279125C15.3483 -0.0930417 14.7466 -0.0930417 14.3742 0.279125L4.93942 9.69781Z"}))),a||(a=o.createElement("defs",null,o.createElement("clipPath",{id:"clip0_9046_23916"},o.createElement("rect",{width:16,height:12,fill:"white"}))))),s=(0,o.forwardRef)(r)},76552:(e,t,i)=>{i.d(t,{Z:()=>r});var n,a=i(70537);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},o.apply(this,arguments)}const l=({title:e,titleId:t,...i},l)=>a.createElement("svg",o({width:24,height:24,viewBox:"0 0 24 24",fill:"#616161",xmlns:"http://www.w3.org/2000/svg",ref:l,"aria-labelledby":t},i),e?a.createElement("title",{id:t},e):null,n||(n=a.createElement("path",{d:"M8 12C8 13.1046 7.10457 14 6 14C4.89543 14 4 13.1046 4 12C4 10.8954 4.89543 10 6 10C7.10457 10 8 10.8954 8 12ZM14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12ZM18 14C19.1046 14 20 13.1046 20 12C20 10.8954 19.1046 10 18 10C16.8954 10 16 10.8954 16 12C16 13.1046 16.8954 14 18 14Z"}))),r=(0,a.forwardRef)(l)},16956:(e,t,i)=>{i.d(t,{Z:()=>r});var n=i(70537),a=i(26602),o=i(80683);function l(e){return e<=16?8:e<=24?12:e<=32?16:e<=40?18:e<=56?22:e<=80?48:64}const r=({src:e="",name:t="Deleted User",type:i="user",width:r,height:s,...d})=>{const[c,u]=(0,n.useState)(!1),v=()=>{u(!0)};if(!c&&e)return(0,o.jsx)("img",{width:r,height:s,src:e,onError:v,...d});let h=(0,a.Qm)(t).substring(0,6);const m=h.length,p=m>2?(11-m)/10:1;return(0,o.jsx)("div",{className:`rounded-full flex-center ${d.className||""}`,style:{width:r,height:s,fontSize:l(r),fontWeight:400,fontFamily:"'Lato', 'Lato-Regular', 'Helvetica Neue'",background:"channel"===i?"#EAECF0":"#4c99e9",color:"channel"===i?"#475467":"#FFFFFF"},children:(0,o.jsx)("span",{className:"whitespace-nowrap",style:{transform:`scale(${p})`},children:h})})}},40234:(e,t,i)=>{i.d(t,{Z:()=>h});var n,a,o=i(7829),l=i(70537);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r.apply(this,arguments)}const s=({title:e,titleId:t,...i},o)=>l.createElement("svg",r({width:16,height:16,viewBox:"0 0 16 16",fill:"#475467",xmlns:"http://www.w3.org/2000/svg",ref:o,"aria-labelledby":t},i),e?l.createElement("title",{id:t},e):null,l.createElement("mask",{id:"mask0_18505_74130",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:0,y:0,width:16,height:16},n||(n=l.createElement("rect",{width:16,height:16,fill:"#D9D9D9"}))),a||(a=l.createElement("g",{mask:"url(#mask0_18505_74130)"},l.createElement("path",{d:"M4.76666 14.0667C4.6 13.9 4.51666 13.7028 4.51666 13.475C4.51666 13.2472 4.6 13.05 4.76666 12.8834L9.65 8.00002L4.75 3.10002C4.59444 2.94446 4.51666 2.75002 4.51666 2.51669C4.51666 2.28335 4.6 2.08335 4.76666 1.91669C4.93333 1.75002 5.13055 1.66669 5.35833 1.66669C5.58611 1.66669 5.78333 1.75002 5.95 1.91669L11.55 7.53335C11.6167 7.60002 11.6639 7.67224 11.6917 7.75002C11.7194 7.8278 11.7333 7.91113 11.7333 8.00002C11.7333 8.08891 11.7194 8.17224 11.6917 8.25002C11.6639 8.3278 11.6167 8.40002 11.55 8.46669L5.93333 14.0834C5.77777 14.2389 5.58611 14.3167 5.35833 14.3167C5.13055 14.3167 4.93333 14.2334 4.76666 14.0667Z"})))),d=(0,l.forwardRef)(s);var c=i(18697),u=i(80683);const v=({items:e,hideMenu:t,child:i})=>(0,u.jsx)(o.ZP,{interactive:!0,placement:"right-start",trigger:"mouseenter focus",content:(0,u.jsx)("ul",{className:"context-menu",children:e.map((e=>{const{title:i,icon:n=null,handler:a=(e=>{e.preventDefault(),t&&t()}),underline:o=!1,danger:l=!1,checked:r=!1}=e;return(0,u.jsxs)("li",{className:`item group ${o?"bottom_line":""} ${l?"danger":""}`,onClick:e=>{e.stopPropagation(),e.preventDefault(),r||(a(e),t&&t())},children:[n,i,r&&(0,u.jsx)(c.Z,{className:"group-hover:fill-white dark:fill-gray-300 absolute right-2 top-2"})]},i)}))}),children:i}),h=({items:e=[],hideMenu:t=null})=>(0,u.jsx)("ul",{className:"context-menu",children:e.map((e=>{const{title:i,icon:n=null,handler:a=(e=>{e.preventDefault(),t&&t()}),underline:o=!1,danger:l=!1,subs:r=[]}=e;return r.length>0?(0,u.jsx)(v,{items:r,hideMenu:t,child:(0,u.jsxs)("li",{className:`item group ${o?"bottom_line":""} ${l?"danger":""}`,onClick:e=>{e.stopPropagation(),e.preventDefault()},children:[n,i,(0,u.jsx)(d,{className:"group-hover:fill-white dark:fill-gray-300 absolute right-2 top-2"})]},i)},i):(0,u.jsxs)("li",{className:`item ${o?"bottom_line":""} ${l?"danger":""}`,onClick:e=>{e.stopPropagation(),e.preventDefault(),a(e),t&&t()},children:[n,i]},i)}))})},62846:(e,t,i)=>{i.d(t,{Z:()=>b});var n,a=i(70537),o=i(14566),l=i(64084),r=i(7829),s=i(75649),d=i(65809),c=i(66160),u=i(22481),v=i(97655);function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},h.apply(this,arguments)}const m=({title:e,titleId:t,...i},o)=>a.createElement("svg",h({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:o,"aria-labelledby":t},i),e?a.createElement("title",{id:t},e):null,n||(n=a.createElement("path",{d:"M12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C10.3596 22 8.77516 21.6039 7.35578 20.8583L3.06538 21.9753C2.6111 22.0937 2.1469 21.8213 2.02858 21.367C1.99199 21.2266 1.99198 21.0791 2.02855 20.9386L3.1449 16.6502C2.3972 15.2294 2 13.6428 2 12C2 6.47715 6.47715 2 12 2Z",fill:"#22CCEE"}))),p=(0,a.forwardRef)(m);var w=i(76552),f=i(16956),g=i(40234),C=i(80683);const x=({uid:e,type:t="embed",cid:i})=>{const{data:n}=(0,d.j9)(),{t:a}=(0,o.$G)("member"),{t:h}=(0,o.$G)(),{canCopyEmail:m,copyEmail:x,startCall:b,removeFromChannel:_,canRemoveFromChannel:E,canRemove:I,removeUser:y,isAdmin:j,canUpdateRole:O,updateRole:A}=(0,u.Z)({uid:e,cid:i}),{data:N}=(0,c.CG)((t=>({data:t.users.byId[e]})));if(!N)return null;const{name:k,email:L,avatar:T}=N,M="card"==t,D=!M&&I,V=L||E||D,Z="cursor-pointer flex flex-col items-center gap-1 rounded-lg w-32 text-primary-400 bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 text-sm pt-3.5 pb-3",R=(0,s.Z)("flex-center flex-col gap-1 z-[99] mt-20 select-none",M?"p-4 w-[280px] bg-white dark:bg-gray-800 drop-shadow rounded-md":"md:w-[432px]");return(0,C.jsxs)("div",{className:R,children:[(0,C.jsx)(f.Z,{width:80,height:80,className:"rounded-full w-20 h-20 object-cover",src:T,name:k}),(0,C.jsxs)("h2",{className:"text-lg select-text font-bold text-gray-900 dark:text-white",children:[k," ",(0,C.jsxs)("span",{className:"font-normal text-gray-500",children:["#",e]})]}),(0,C.jsx)("span",{className:"text-sm text-gray-400 dark:text-gray-200 select-text",children:L}),(0,C.jsxs)("ul",{className:(0,s.Z)("mt-6 flex flex-col md:flex-row items-center gap-2",M&&"pb-0.5"),children:[(0,C.jsx)(l.OL,{to:`/chat/dm/${e}`,children:(0,C.jsxs)("li",{className:`${Z} icon chat`,children:[(0,C.jsx)(p,{}),(0,C.jsx)("span",{children:a("send_msg")})]})}),n&&"embed"==t&&(0,C.jsxs)("li",{role:"button",onClick:b,className:`${Z} icon chat`,children:[(0,C.jsx)(v.Z,{className:"fill-primary-400"}),(0,C.jsx)("span",{children:a("call")})]}),(0,C.jsx)(r.ZP,{disabled:!V,interactive:!0,popperOptions:{strategy:"fixed"},placement:"right",trigger:"click",hideOnClick:!0,content:(0,C.jsx)(g.Z,{items:[n&&"card"==t&&{title:a("call"),handler:b},m&&{title:a("copy_email"),handler:x},O&&{title:a("roles"),handler:A,subs:[{title:a("set_normal"),checked:!j,handler:A},{title:a("set_admin"),checked:j,handler:A}]},E&&{title:a("remove_from_channel"),danger:!0,handler:_},D&&{title:a("remove"),handler:y,danger:!0}].filter(Boolean)}),children:(0,C.jsxs)("li",{className:`${Z} icon ${V?"":"text-gray-500"}`,children:[(0,C.jsx)(w.Z,{className:V?"fill-primary-500":""}),(0,C.jsx)("span",{children:h("more")})]})})]})]})},b=(0,a.memo)(x)},33478:(e,t,i)=>{i.d(t,{Z:()=>s});var n=i(7829),a=i(75649),o=i(26602),l=i(80683);const r=({placement:e})=>{if("left"==e)return null;const t=(0,a.Z)("w-3 h-3 bg-inherit absolute rounded-[1px] origin-center rotate-45","right"==e&&"left-0 top-1/2 -translate-x-1/2 -translate-y-1/2","top"==e&&"left-1/2 bottom-0 -translate-x-1/2 translate-y-1/2","bottom"==e&&"top-0 left-1/2 -translate-x-1/2 -translate-y-1/2");return(0,l.jsx)("i",{className:t})},s=({tip:e="",placement:t="right",delay:i=null,children:a,...s})=>(0,l.jsx)(n.ZP,{disabled:(0,o.tq)(),offset:[0,18],duration:i?[300,250]:0,delay:null!==i&&void 0!==i?i:[150,0],placement:t,content:(0,l.jsxs)("div",{className:"relative bg-white dark:bg-gray-800 px-3 py-2 text-xs rounded-lg drop-shadow text-gray-700 dark:text-gray-100",children:[(0,l.jsx)(r,{placement:t}),e]}),...s,children:a})},56885:(e,t,i)=>{i.d(t,{Z:()=>j,M:()=>C.Z});var n=i(70537),a=i(3074),o=i(80829),l=i.n(o),r=i(65809),s=i(971),d=i(66160),c=i(26602),u=i(15924),v=i(37076),h=i(75649),m=i(39114),p=i(38761),w=i(97655),f=i(16956),g=i(33478),C=i(15475),x=i(80683);const b=({from:e,to:t=0})=>{const i=(0,u.s0)(),{pathname:o}=(0,u.TH)(),l=(0,a.I0)(),{leave:r,joinVoice:b,joining:_}=(0,C.Z)({id:t,context:"dm"}),E=(0,n.useRef)(null),{calling:I,voicingMembers:y,fromUser:j,toUser:O,loginUser:A}=(0,d.CG)((i=>({calling:i.voice.calling,voicingMembers:i.voice.voicingMembers,fromUser:i.users.byId[e],toUser:i.users.byId[t],loginUser:i.authData.user}))),N=(null===A||void 0===A?void 0:A.uid)!==O.uid;(0,n.useEffect)((()=>{y.ids.forEach((e=>{(0,c.L_)(e)}))}),[y.ids]);const{name:k,avatar:L}=N?O:j,T=2==y.ids.length;return j&&O&&!T&&!(N?o==`/chat/dm/${t}`:o==`/chat/dm/${e}`)&&I?(0,x.jsx)("div",{ref:E,className:"fixed top-0 left-0 w-full h-screen z-[999] pointer-events-none flex items-center justify-end pr-10",children:(0,x.jsxs)(m.E.aside,{drag:!0,dragConstraints:E,dragMomentum:!1,whileDrag:{scale:1.1},className:(0,h.Z)("pointer-events-auto \n        rounded bg-gray-800  relative\n        shadow-lg shadow-slate-200 dark:shadow-slate-800 \n        cursor-move overflow-hidden\n        w-64 h-80\n        "),children:[(0,x.jsx)("div",{className:"absolute right-0-0 top-0 w-40 h-32",id:`CAMERA_${t}`}),(0,x.jsxs)("div",{className:(0,h.Z)("absolute left-0 top-0 py-5 w-full h-full flex flex-col justify-between items-center",T?"bg-transparent":"bg-gray-800"),children:[(0,x.jsxs)("div",{className:"flex flex-col gap-2 items-center",children:[(0,x.jsx)("div",{className:"rounded-full overflow-hidden w-20 h-20 shrink-0",children:(0,x.jsx)(f.Z,{name:k,src:L,width:80,height:80,className:"h-20"})}),(0,x.jsx)("span",{className:"text-white mb-2",children:k})]}),(0,x.jsxs)("div",{className:"flex flex-col gap-1 items-center my-4",children:[(0,x.jsx)(v.Z,{size:18,lineWeight:3,speed:1,color:"#aaa"}),(0,x.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:N?"Calling":"Incoming call"})]}),(0,x.jsxs)("div",{className:(0,h.Z)("flex gap-3",T?"h-full items-end":""),children:[(0,x.jsx)(g.Z,{tip:"Disconnect",placement:"top",children:(0,x.jsx)("button",{onClick:()=>{(N||2==y.ids.length)&&r(),l((0,s.Qv)(!1))},className:"flex-center bg-red-600 hover:bg-red-700 py-2 px-3 rounded-lg",children:(0,x.jsx)(p.Z,{className:"w-6 h-6"})})}),!N&&(0,x.jsx)(g.Z,{tip:"Answer",placement:"top",children:(0,x.jsx)("button",{disabled:_,onClick:()=>{b(),i(`/chat/dm/${e}`)},className:"flex-center bg-green-600 hover:bg-green-700 py-2 px-3 rounded-lg",children:(0,x.jsx)(w.Z,{className:"w-6 h-6 fill-white"})})})]})]})]})}):null};var _,E;l().setLogLevel(4),window.VOICE_TRACK_MAP=null!==(_=window.VOICE_TRACK_MAP)&&void 0!==_?_:{},window.VIDEO_TRACK_MAP=null!==(E=window.VIDEO_TRACK_MAP)&&void 0!==E?E:{};const I=(0,c.zd)(),y=()=>{const{from:e,to:t,voiceList:i,loginUid:o,voicingInfo:u}=(0,d.CG)((e=>{var t;return{voicingInfo:e.voice.voicing,voiceList:e.voice.list,from:e.voice.callingFrom,to:e.voice.callingTo,loginUid:null===(t=e.authData.user)||void 0===t?void 0:t.uid}})),{data:v}=(0,r.j9)(),[h]=(0,r.Qg)();(0,r.K0)({page_no:0,page_size:100},{skip:!v||!navigator.onLine});const m=(0,a.I0)();return(0,n.useEffect)((()=>{const e=e=>{var t;if("CONNECTED"===(null===(t=window.VOICE_CLIENT)||void 0===t?void 0:t.connectionState))return e.preventDefault(),e.returnValue=""};return window.VOICE_CLIENT||I||((async()=>{const e=l().createClient({mode:"rtc",codec:"vp8"});e.enableAudioVolumeIndicator(),e.on("user-published",(async(t,i)=>{var n;await e.subscribe(t,i),"audio"==i&&t.hasAudio&&(null===(n=t.audioTrack)||void 0===n||n.play(),window.VOICE_TRACK_MAP[+t.uid]=t.audioTrack),"video"==i&&t.hasVideo&&(m((0,s.sm)({uid:+t.uid,info:{video:!0}})),window.VIDEO_TRACK_MAP[+t.uid]=t.videoTrack,(0,c.L_)(+t.uid)),e.on("user-unpublished",(e=>{e.hasAudio||m((0,s.sm)({uid:+e.uid,info:{muted:!0}})),e.hasVideo||(m((0,s.sm)({uid:+e.uid,info:{video:!1,shareScreen:!1}})),window.VIDEO_TRACK_MAP[+e.uid]=null,document.querySelector(`#CAMERA_${e.uid}`).classList.remove("h-[120px]"))})),e.on("user-left",((e,t)=>{switch(t){case"Quit":case"ServerTimeOut":m((0,s.h_)(+e.uid)),window.VOICE_TRACK_MAP[+e.uid]=null,window.VIDEO_TRACK_MAP[+e.uid]=null}})),e.on("volume-indicator",(e=>{e.forEach(((e,t)=>{e.uid,e.level;const{uid:i,level:n}=e;m((0,s.sm)({uid:+i,info:{speakingVolume:n}}))}))})),e.on("network-quality",(e=>{const{downlinkNetworkQuality:t}=e;m((0,s.U_)(t))})),e.on("connection-state-change",((e,t,i)=>{m((0,s.$6)(e))})),e.on("user-info-updated",((e,t)=>{switch(t){case"mute-audio":m((0,s.sm)({uid:+e,info:{muted:!0}}));break;case"unmute-audio":m((0,s.sm)({uid:+e,info:{muted:!1}}));break;case"mute-video":m((0,s.sm)({uid:+e,info:{video:!1}}));break;case"unmute-video":m((0,s.sm)({uid:+e,info:{video:!0}}))}}))})),e.on("user-joined",(async e=>{e.uid,m((0,s.Bu)(+e.uid))})),l().onMicrophoneChanged=e=>{},window.VOICE_CLIENT=e})(),window.addEventListener("beforeunload",e,{capture:!0})),()=>{window.removeEventListener("beforeunload",e,{capture:!0})}}),[u]),(0,n.useEffect)((()=>{if(I)return;const e=i.filter((e=>"dm"==e.context&&e.id==o));if(e.length){const[t]=e,{memberCount:i,channelName:n,id:a}=t;1==i&&h(n).then((e=>{var t;const[i]=null!==(t=e.data)&&void 0!==t?t:[];i&&i!=o&&m((0,s.vH)({from:i,to:a}))}))}}),[i,o,I]),0!==e?(0,x.jsx)(b,{from:e,to:t}):null},j=(0,n.memo)(y)},15475:(e,t,i)=>{i.d(t,{Z:()=>h});var n=i(3074),a=i(80829),o=i.n(a);const l=i.p+"static/media/join.32e45d691d059a55188a.wav";var r=i(65809),s=i(81980),d=i(971),c=i(66160),u=i(26602);const v=new Audio(l),h=({id:e,context:t="channel"})=>{const i=(0,n.I0)(),{voicingInfo:a,loginUid:l,audioInputDevices:h,audioOutputDevices:m,videoInputDevices:p,audioInputDeviceId:w,audioOutputDeviceId:f,videoInputDeviceId:g,fullscreen:C}=(0,c.CG)((i=>{var n,a,o,l,r;return{fullscreen:"channel"==t?"voice_fullscreen"==i.footprint.channelAsides[e]:"voice_fullscreen"==i.footprint.dmAsides[e],loginUid:null!==(n=null===(a=i.authData.user)||void 0===a?void 0:a.uid)&&void 0!==n?n:0,voicingInfo:i.voice.voicing,audioInputDevices:null!==(o=i.voice.devices.filter((e=>"audioinput"==e.kind)))&&void 0!==o?o:[],audioOutputDevices:null!==(l=i.voice.devices.filter((e=>"audiooutput"==e.kind)))&&void 0!==l?l:[],videoInputDevices:null!==(r=i.voice.devices.filter((e=>"videoinput"==e.kind)))&&void 0!==r?r:[],audioInputDeviceId:i.voice.audioInputDeviceId,audioOutputDeviceId:i.voice.audioOutputDeviceId,videoInputDeviceId:i.voice.videoInputDeviceId}})),[x]=(0,r._S)(),b=async()=>{const n=window.VIDEO_TRACK_MAP[l];if(n){var a;await(null===(a=window.VOICE_CLIENT)||void 0===a?void 0:a.unpublish(n)),n.close(),window.VIDEO_TRACK_MAP[l]=null;document.querySelector(`#CAMERA_${l}`).classList.remove("h-[120px]"),i((0,d.Su)({video:!1,shareScreen:!1,id:e,context:t}))}},_=async()=>{var n;let a=window.VIDEO_TRACK_MAP[l];if(!a)return;await(null===(n=window.VOICE_CLIENT)||void 0===n?void 0:n.unpublish(a)),"close"in a?a.close():a[0].close(),window.VIDEO_TRACK_MAP[l]=null;document.querySelector(`#CAMERA_${l}`).classList.remove("h-[120px]"),i((0,d.Su)({video:!1,shareScreen:!1,id:e,context:t}))},E=!!a&&(a.id==e&&a.context==t);return{setMute:n=>{const o=window.VOICE_TRACK_MAP[l];o&&(o.setMuted(n),0==n&&null!==a&&void 0!==a&&a.deafen&&(Object.entries(window.VOICE_TRACK_MAP).forEach((([,e])=>{null===e||void 0===e||e.setVolume(100)})),i((0,d.Su)({muted:!1,id:e,context:t}))),i((0,d.Su)({muted:n,id:e,context:t})))},setDeafen:n=>{const a=window.VOICE_TRACK_MAP[l];a&&(n?(a.setMuted(!0),Object.entries(window.VOICE_TRACK_MAP).forEach((([,e])=>{null===e||void 0===e||e.setVolume(0)}))):(a.setMuted(!1),Object.entries(window.VOICE_TRACK_MAP).forEach((([,e])=>{null===e||void 0===e||e.setVolume(100)}))),i((0,d.Su)({deafen:n,id:e,context:t})))},leave:async()=>{const n=window.VOICE_TRACK_MAP[l],a=window.VIDEO_TRACK_MAP[l];if(window.VOICE_CLIENT){await window.VOICE_CLIENT.leave(),n&&(n.close(),window.VOICE_TRACK_MAP[l]=null),a&&(a.close(),window.VIDEO_TRACK_MAP[l]=null),window.VOICE_TRACK_MAP={},window.VIDEO_TRACK_MAP={},i((0,d.Su)(null));const o="channel"==t?s.Kp:s.dZ;i(o({id:e,aside:"dm"==t?"voice":null})),i((0,d.IZ)({id:e,context:t,memberCount:"dm"==t?1:0,channelName:`vocechat:${t}:${e}`}))}},voicingInfo:a,joining:a?a.joining:void 0,joinedAtThisContext:E,joined:!!a,joinVoice:async()=>{i((0,d.Su)({id:e,context:t,joining:!0}));const n=await x("channel"==t?{gid:e}:{uid:e});if("error"in n)console.error("generate agora token error"),i((0,d.Su)({joining:!1,id:e,context:t}));else{console.table(n.data);const{channel_name:r,app_id:s,agora_token:c,uid:u}=n.data;if(window.VOICE_CLIENT){await window.VOICE_CLIENT.join(s,r,c,u);const n=await o().createMicrophoneAudioTrack({microphoneId:w});await window.VOICE_CLIENT.publish(n);try{await v.play()}catch(a){console.warn("play join sound failed!",a)}i((0,d.Su)({deafen:!1,muted:!1,joining:!1,id:e,context:t})),i((0,d.Bu)(u)),window.VOICE_TRACK_MAP[l]=n}}},openCamera:async()=>{var n;const a=await o().createCameraVideoTrack({cameraId:g});await _(),await(null===(n=window.VOICE_CLIENT)||void 0===n?void 0:n.publish(a)),i((0,d.Su)({video:!0,shareScreen:!1,id:e,context:t})),window.VIDEO_TRACK_MAP[l]=a,(0,u.L_)(l)},closeCamera:b,startShareScreen:async()=>{try{var n;const a=await o().createScreenVideoTrack({selfBrowserSurface:"exclude",encoderConfig:"1080p_1",optimizationMode:"detail"});await b(),await(null===(n=window.VOICE_CLIENT)||void 0===n?void 0:n.publish(a)),i((0,d.Su)({video:!1,shareScreen:!0,id:e,context:t})),window.VIDEO_TRACK_MAP[l]=a,(0,u.L_)(l),i("channel"==t?(0,s.Kp)({id:e,aside:"voice_fullscreen"}):(0,s.dZ)({id:e,aside:"voice_fullscreen"})),i((0,d.fT)({uid:l,action:"pin"})),"close"in a&&(a.getMediaStreamTrack().onended=()=>{_()})}catch(a){}},stopShareScreen:_,enterFullscreen:n=>{i("channel"==t?(0,s.Kp)({id:e,aside:"voice_fullscreen"}):(0,s.dZ)({id:e,aside:"voice_fullscreen"})),n&&i((0,d.fT)({uid:n,action:"pin"}))},exitFullscreen:()=>{i("channel"==t?(0,s.Kp)({id:e,aside:"voice"}):(0,s.dZ)({id:e,aside:null}))},fullscreen:C,audioInputDevices:h,audioOutputDevices:m,videoInputDevices:p,audioInputDeviceId:w,audioOutputDeviceId:f,videoInputDeviceId:g}}},22481:(e,t,i)=>{i.d(t,{Z:()=>w});var n=i(70537),a=i(27418),o=i(14566),l=i(3074),r=i(15924),s=i(69195),d=i(6144),c=i(52334),u=i(81980),v=i(971),h=i(66160),m=i(56885),p=i(63965);const w=({uid:e,cid:t})=>{const{joinVoice:i,joined:w,joining:f=!1,joinedAtThisContext:g}=(0,m.M)({id:null!==e&&void 0!==e?e:0,context:"dm"}),C=(0,l.I0)(),{t:x}=(0,o.$G)(),[b,_]=(0,n.useState)(void 0),E=(0,r.bS)(`/users/${e}`),[I]=(0,c.C6)(),[y,{isSuccess:j}]=(0,c.kD)(),[O,{isSuccess:A}]=(0,c.EO)(),[N,{isSuccess:k}]=(0,d.Cg)(),L=(0,r.s0)(),{copy:T}=(0,p.Z)(),{user:M,channel:D,loginUser:V}=(0,h.CG)((i=>({user:"undefined"!==typeof e?i.users.byId[e]:e,channel:"undefined"!==typeof t?i.channels.byId[t]:t,loginUser:i.authData.user})));(0,n.useEffect)((()=>{_(null!==e&&void 0!==e?e:null===V||void 0===V?void 0:V.uid)}),[e,V]),(0,n.useEffect)((()=>{j&&a.ZP.success(x("tip.update"))}),[j]),(0,n.useEffect)((()=>{(k||A)&&(a.ZP.success(x("tip.delete")),A&&E&&L("/users"))}),[k,A,E]);const Z=!(null===V||void 0===V||!V.is_admin),R=null===V||void 0===V?void 0:V.uid,P=!!t&&!(null!==D&&void 0!==D&&D.is_public)&&Z,S=!!t&&!(null!==D&&void 0!==D&&D.is_public)&&(Z||(null===D||void 0===D?void 0:D.owner)==R)&&e!=(null===D||void 0===D?void 0:D.owner),K=Z&&R!=e&&!t&&1!==e,$=R!=e,U=R!=e,F=!!t&&((null===V||void 0===V?void 0:V.is_admin)||(null===D||void 0===D?void 0:D.owner)==(null===V||void 0===V?void 0:V.uid));return{isAdmin:!(null===M||void 0===M||!M.is_admin),updateRole:()=>{e&&y({id:e,is_admin:!(null!==M&&void 0!==M&&M.is_admin)})},canUpdateRole:Z&&R!=e&&1!=e,removeFromContact:()=>{e&&I({target_uid:e,action:"remove"})},canBlock:$,canRemoveFromContact:U,blocked:"blocked"==(null===M||void 0===M?void 0:M.status),blockThisContact:()=>{void 0!==e&&I({target_uid:e,action:"block"})},unblockThisContact:()=>{void 0!==e&&I({target_uid:e,action:"unblock"})},canInviteChannel:F,canDeleteChannel:P,canRemove:K,removeUser:e=>{const t=!Number.isNaN(+e)&&e||b;t&&(O(t),(0,s.Bn)())},startChat:()=>{L(`/chat/dm/${e}`)},removeFromChannel:e=>{if(!t)return;const i=!Number.isNaN(+e)&&e||b;i&&(N({id:+t,members:[+i]}),(0,s.Bn)())},canRemoveFromChannel:S,canCopyEmail:!(null===M||void 0===M||!M.email),copyEmail:e=>{const t="string"==typeof e&&e||(null===M||void 0===M?void 0:M.email);T(t||""),(0,s.Bn)()},startCall:()=>{if(f||w)return void alert("You have joined another channel, please leave first!");i();const t={id:null!==e&&void 0!==e?e:0,aside:"voice"};var n;(C((0,u.dZ)(t)),g)||C((0,v.vH)({from:null!==(n=null===V||void 0===V?void 0:V.uid)&&void 0!==n?n:0,to:e,calling:!1}));L(`/chat/dm/${e}`)}}}}}]);