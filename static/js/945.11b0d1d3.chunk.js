"use strict";(globalThis.webpackChunkvocechat_web=globalThis.webpackChunkvocechat_web||[]).push([[945],{23545:(e,t,n)=>{n.d(t,{A:()=>r});var i,a=n(81084);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},l.apply(null,arguments)}const o=({title:e,titleId:t,...n},o)=>a.createElement("svg",l({width:24,height:24,viewBox:"0 0 24 24",fill:"white",xmlns:"http://www.w3.org/2000/svg",ref:o,"aria-labelledby":t},n),e?a.createElement("title",{id:t},e):null,i||(i=a.createElement("path",{d:"M21.7806 2.21967C22.0735 2.51256 22.0735 2.98744 21.7806 3.28033L18.5609 6.5L21.7806 9.71967C22.0735 10.0126 22.0735 10.4874 21.7806 10.7803C21.4877 11.0732 21.0128 11.0732 20.7199 10.7803L17.5002 7.56066L14.2806 10.7803C13.9877 11.0732 13.5128 11.0732 13.2199 10.7803C12.927 10.4874 12.927 10.0126 13.2199 9.71967L16.4396 6.5L13.2199 3.28033C12.927 2.98744 12.927 2.51256 13.2199 2.21967C13.5128 1.92678 13.9877 1.92678 14.2806 2.21967L17.5002 5.43934L20.7199 2.21967C21.0128 1.92678 21.4877 1.92678 21.7806 2.21967ZM9.36737 3.31232L10.2271 5.33967C10.6018 6.22312 10.3939 7.26203 9.71313 7.90815L7.81881 9.70616C7.93569 10.7816 8.2972 11.8406 8.90334 12.8832C9.50948 13.9257 10.2665 14.7905 11.1744 15.4776L13.4496 14.7189C14.312 14.4313 15.2512 14.7618 15.7802 15.539L17.0125 17.3495C17.6275 18.2529 17.5169 19.4993 16.7538 20.2653L15.9361 21.0862C15.1222 21.9033 13.9597 22.1997 12.8843 21.8643C10.3454 21.0723 8.01109 18.7211 5.88132 14.8107C3.74845 10.8945 2.9957 7.57189 3.62307 4.84289C3.88707 3.69457 4.70458 2.78009 5.77209 2.43899L6.84868 2.09498C7.8575 1.77263 8.93535 2.29358 9.36737 3.31232Z"}))),r=(0,a.forwardRef)(o)},89220:(e,t,n)=>{n.d(t,{A:()=>r});var i,a=n(81084);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},l.apply(null,arguments)}const o=({title:e,titleId:t,...n},o)=>a.createElement("svg",l({width:24,height:24,viewBox:"0 0 24 24",fill:"#70707B",xmlns:"http://www.w3.org/2000/svg",ref:o,"aria-labelledby":t},n),e?a.createElement("title",{id:t},e):null,i||(i=a.createElement("path",{d:"M7.7716 2.43923L8.84819 2.09522C9.85701 1.77287 10.9349 2.29382 11.3669 3.31256L12.2266 5.33991C12.6013 6.22336 12.3934 7.26227 11.7126 7.9084L9.81832 9.70641C9.9352 10.7819 10.2967 11.8409 10.9029 12.8834C11.509 13.9259 12.266 14.7907 13.1739 15.4778L15.4491 14.7191C16.3115 14.4315 17.2507 14.762 17.7797 15.5392L19.0121 17.3498C19.627 18.2532 19.5164 19.4995 18.7534 20.2655L17.9356 21.0865C17.1217 21.9036 15.9592 22.2 14.8838 21.8645C12.3449 21.0726 10.0106 18.7214 7.88083 14.8109C5.74796 10.8947 4.99521 7.57214 5.62258 4.84313C5.88658 3.69482 6.70409 2.78033 7.7716 2.43923Z"}))),r=(0,a.forwardRef)(o)},33329:(e,t,n)=>{n.d(t,{A:()=>d});var i,a,l=n(81084);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(null,arguments)}const r=({title:e,titleId:t,...n},r)=>l.createElement("svg",o({width:16,height:12,viewBox:"0 0 16 12",fill:"#78787C",xmlns:"http://www.w3.org/2000/svg",ref:r,"aria-labelledby":t},n),e?l.createElement("title",{id:t},e):null,i||(i=l.createElement("g",{clipPath:"url(#clip0_9046_23916)"},l.createElement("path",{d:"M4.93942 9.69781L1.62578 6.38648C1.25336 6.01431 0.651746 6.01431 0.27932 6.38648C-0.0931066 6.75865 -0.0931066 7.35984 0.27932 7.73201L4.27096 11.7209C4.64339 12.093 5.245 12.093 5.61743 11.7209L15.7207 1.62465C16.0931 1.25248 16.0931 0.651292 15.7207 0.279125C15.3483 -0.0930417 14.7466 -0.0930417 14.3742 0.279125L4.93942 9.69781Z"}))),a||(a=l.createElement("defs",null,l.createElement("clipPath",{id:"clip0_9046_23916"},l.createElement("rect",{width:16,height:12,fill:"white"}))))),d=(0,l.forwardRef)(r)},21479:(e,t,n)=>{n.d(t,{A:()=>r});var i,a=n(81084);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},l.apply(null,arguments)}const o=({title:e,titleId:t,...n},o)=>a.createElement("svg",l({width:24,height:24,viewBox:"0 0 24 24",fill:"#616161",xmlns:"http://www.w3.org/2000/svg",ref:o,"aria-labelledby":t},n),e?a.createElement("title",{id:t},e):null,i||(i=a.createElement("path",{d:"M8 12C8 13.1046 7.10457 14 6 14C4.89543 14 4 13.1046 4 12C4 10.8954 4.89543 10 6 10C7.10457 10 8 10.8954 8 12ZM14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12ZM18 14C19.1046 14 20 13.1046 20 12C20 10.8954 19.1046 10 18 10C16.8954 10 16 10.8954 16 12C16 13.1046 16.8954 14 18 14Z"}))),r=(0,a.forwardRef)(o)},47003:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(81084),a=n(21444),l=n(99264);function o(e){return e<=16?8:e<=24?12:e<=32?16:e<=40?18:e<=56?22:e<=80?48:64}const r=({src:e="",name:t="Deleted User",type:n="user",width:r,height:d,...s})=>{const[c,u]=(0,i.useState)(!1),h=()=>{u(!0)};if(!c&&e)return(0,l.jsx)("img",{width:r,height:d,src:e,onError:h,...s});let v=(0,a.IM)(t).substring(0,6);const m=v.length,w=m>2?(11-m)/10:1;return(0,l.jsx)("div",{className:`rounded-full flex-center ${s.className||""}`,style:{width:r,height:d,fontSize:o(r),fontWeight:400,fontFamily:"'Lato', 'Lato-Regular', 'Helvetica Neue'",background:"channel"===n?"#EAECF0":"#4c99e9",color:"channel"===n?"#475467":"#FFFFFF"},children:(0,l.jsx)("span",{className:"whitespace-nowrap",style:{transform:`scale(${w})`},children:v})})}},98633:(e,t,n)=>{n.d(t,{A:()=>v});var i,a,l=n(95380),o=n(81084);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r.apply(null,arguments)}const d=({title:e,titleId:t,...n},l)=>o.createElement("svg",r({width:16,height:16,viewBox:"0 0 16 16",fill:"#475467",xmlns:"http://www.w3.org/2000/svg",ref:l,"aria-labelledby":t},n),e?o.createElement("title",{id:t},e):null,o.createElement("mask",{id:"mask0_18505_74130",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:0,y:0,width:16,height:16},i||(i=o.createElement("rect",{width:16,height:16,fill:"#D9D9D9"}))),a||(a=o.createElement("g",{mask:"url(#mask0_18505_74130)"},o.createElement("path",{d:"M4.76666 14.0667C4.6 13.9 4.51666 13.7028 4.51666 13.475C4.51666 13.2472 4.6 13.05 4.76666 12.8834L9.65 8.00002L4.75 3.10002C4.59444 2.94446 4.51666 2.75002 4.51666 2.51669C4.51666 2.28335 4.6 2.08335 4.76666 1.91669C4.93333 1.75002 5.13055 1.66669 5.35833 1.66669C5.58611 1.66669 5.78333 1.75002 5.95 1.91669L11.55 7.53335C11.6167 7.60002 11.6639 7.67224 11.6917 7.75002C11.7194 7.8278 11.7333 7.91113 11.7333 8.00002C11.7333 8.08891 11.7194 8.17224 11.6917 8.25002C11.6639 8.3278 11.6167 8.40002 11.55 8.46669L5.93333 14.0834C5.77777 14.2389 5.58611 14.3167 5.35833 14.3167C5.13055 14.3167 4.93333 14.2334 4.76666 14.0667Z"})))),s=(0,o.forwardRef)(d);var c=n(33329),u=n(99264);const h=({items:e,hideMenu:t,child:n})=>(0,u.jsx)(l.Ay,{interactive:!0,placement:"right-start",trigger:"mouseenter focus",content:(0,u.jsx)("ul",{className:"context-menu",children:e.map((e=>{const{title:n,icon:i=null,handler:a=(e=>{e.preventDefault(),t&&t()}),underline:l=!1,danger:o=!1,checked:r=!1}=e;return(0,u.jsxs)("li",{className:`item group ${l?"bottom_line":""} ${o?"danger":""}`,onClick:e=>{e.stopPropagation(),e.preventDefault(),r||(a(e),t&&t())},children:[i,n,r&&(0,u.jsx)(c.A,{className:"group-hover:fill-white dark:fill-gray-300 absolute right-2 top-2"})]},n)}))}),children:n}),v=({items:e=[],hideMenu:t=null})=>(0,u.jsx)("ul",{className:"context-menu",children:e.map((e=>{const{title:n,icon:i=null,handler:a=(e=>{e.preventDefault(),t&&t()}),underline:l=!1,danger:o=!1,subs:r=[]}=e;return r.length>0?(0,u.jsx)(h,{items:r,hideMenu:t,child:(0,u.jsxs)("li",{className:`item group ${l?"bottom_line":""} ${o?"danger":""}`,onClick:e=>{e.stopPropagation(),e.preventDefault()},children:[i,n,(0,u.jsx)(s,{className:"group-hover:fill-white dark:fill-gray-300 absolute right-2 top-2"})]},n)},n):(0,u.jsxs)("li",{className:`item ${l?"bottom_line":""} ${o?"danger":""}`,onClick:e=>{e.stopPropagation(),e.preventDefault(),a(e),t&&t()},children:[i,n]},n)}))})},92316:(e,t,n)=>{n.d(t,{A:()=>A});var i,a=n(81084),l=n(43307),o=n(80772),r=n(95380),d=n(45774),s=n(13631),c=n(80724),u=n(20905),h=n(89220);function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},v.apply(null,arguments)}const m=({title:e,titleId:t,...n},l)=>a.createElement("svg",v({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:l,"aria-labelledby":t},n),e?a.createElement("title",{id:t},e):null,i||(i=a.createElement("path",{d:"M12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C10.3596 22 8.77516 21.6039 7.35578 20.8583L3.06538 21.9753C2.6111 22.0937 2.1469 21.8213 2.02858 21.367C1.99199 21.2266 1.99198 21.0791 2.02855 20.9386L3.1449 16.6502C2.3972 15.2294 2 13.6428 2 12C2 6.47715 6.47715 2 12 2Z",fill:"#22CCEE"}))),w=(0,a.forwardRef)(m);var p=n(21479),f=n(47003),g=n(98633),C=n(52205),b=n(99264);const x=({uid:e,type:t="embed",cid:n})=>{const{data:i}=(0,s.A4)(),{t:a}=(0,l.Bd)("member"),{t:v}=(0,l.Bd)(),{canDM:m,canCopyEmail:x,copyEmail:A,startCall:_,removeFromChannel:y,canRemoveFromChannel:E,canRemove:j,removeUser:N,isAdmin:I,canUpdateRole:V,updateRole:O}=(0,u.A)({uid:e,cid:n}),k=(0,c.GV)((t=>t.users.byId[e]),C.bN);if(!k)return null;const{name:R,email:M,avatar:T}=k,L="card"==t,D=!L&&j,P=M||E||D,$="cursor-pointer flex flex-col items-center gap-1 rounded-lg w-32 text-primary-400 bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 text-sm pt-3.5 pb-3",K=(0,d.A)("flex-center flex-col gap-1 z-[99] mt-20 select-none",L?"p-4 w-[280px] bg-white dark:bg-gray-800 drop-shadow rounded-md":"md:w-[432px]");return(0,b.jsxs)("div",{className:K,children:[(0,b.jsx)(f.A,{width:80,height:80,className:"rounded-full w-20 h-20 object-cover",src:T,name:R}),(0,b.jsxs)("h2",{className:"text-lg select-text font-bold text-gray-900 dark:text-white",children:[R," ",m&&(0,b.jsxs)("span",{className:"font-normal text-gray-500",children:["#",e]})]}),x&&(0,b.jsx)("span",{className:"text-sm text-gray-400 dark:text-gray-200 select-text",children:M}),m&&(0,b.jsxs)("ul",{className:(0,d.A)("mt-6 flex flex-col md:flex-row items-center gap-2",L&&"pb-0.5"),children:[(0,b.jsx)(o.k2,{to:`/chat/dm/${e}`,children:(0,b.jsxs)("li",{className:`${$} icon chat`,children:[(0,b.jsx)(w,{}),(0,b.jsx)("span",{children:a("send_msg")})]})}),i&&"embed"==t&&(0,b.jsxs)("li",{role:"button",onClick:_,className:`${$} icon chat`,children:[(0,b.jsx)(h.A,{className:"fill-primary-400"}),(0,b.jsx)("span",{children:a("call")})]}),(0,b.jsx)(r.Ay,{disabled:!P,interactive:!0,popperOptions:{strategy:"fixed"},placement:"right",trigger:"click",hideOnClick:!0,content:(0,b.jsx)(g.A,{items:[i&&"card"==t&&{title:a("call"),handler:_},x&&{title:a("copy_email"),handler:A},V&&{title:a("roles"),handler:O,subs:[{title:a("set_normal"),checked:!I,handler:O},{title:a("set_admin"),checked:I,handler:O}]},E&&{title:a("remove_from_channel"),danger:!0,handler:y},D&&{title:a("remove"),handler:N,danger:!0}].filter(Boolean)}),children:(0,b.jsxs)("li",{className:`${$} icon ${P?"":"text-gray-500"}`,children:[(0,b.jsx)(p.A,{className:P?"fill-primary-500":""}),(0,b.jsx)("span",{children:v("more")})]})})]})]})},A=(0,a.memo)(x)},58111:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(95380),a=n(45774),l=n(21444),o=n(99264);const r=({placement:e})=>{if("left"==e)return null;const t=(0,a.A)("w-3 h-3 bg-inherit absolute rounded-[1px] origin-center rotate-45","right"==e&&"left-0 top-1/2 -translate-x-1/2 -translate-y-1/2","top"==e&&"left-1/2 bottom-0 -translate-x-1/2 translate-y-1/2","bottom"==e&&"top-0 left-1/2 -translate-x-1/2 -translate-y-1/2");return(0,o.jsx)("i",{className:t})},d=({tip:e="",placement:t="right",delay:n=null,children:a,...d})=>(0,o.jsx)(i.Ay,{disabled:(0,l.Fr)(),offset:[0,18],duration:n?[300,250]:0,delay:null!==n&&void 0!==n?n:[150,0],placement:t,content:(0,o.jsxs)("div",{className:"relative bg-white dark:bg-gray-800 px-3 py-2 text-xs rounded-lg drop-shadow text-gray-700 dark:text-gray-100",children:[(0,o.jsx)(r,{placement:t}),e]}),...d,children:a})},47789:(e,t,n)=>{n.d(t,{A:()=>E,c:()=>g.A});var i=n(81084),a=n(52205),l=n(25472),o=n(13631),r=n(48979),d=n(80724),s=n(21444),c=n(76644),u=n(73781),h=n(45774),v=n(97039),m=n(23545),w=n(89220),p=n(47003),f=n(58111),g=n(8776),C=n(99264);const b=({from:e,to:t=0})=>{const n=(0,c.Zp)(),{pathname:l}=(0,c.zy)(),o=(0,a.wA)(),{leave:b,joinVoice:x,joining:A}=(0,g.A)({id:t,context:"dm"}),_=(0,i.useRef)(null),y=(0,d.GV)((e=>{var t;return null===(t=e.authData.user)||void 0===t?void 0:t.uid}),a.bN),E=(0,d.GV)((e=>e.voice.calling),a.bN),j=(0,d.GV)((e=>e.voice.voicingMembers),a.bN),N=(0,d.GV)((t=>t.users.byId[e]),a.bN),I=(0,d.GV)((e=>e.users.byId[t]),a.bN),V=y!==I.uid;(0,i.useEffect)((()=>{j.ids.forEach((e=>{(0,s.Qv)(e)}))}),[j.ids]);const{name:O,avatar:k}=V?I:N,R=2==j.ids.length;return N&&I&&!R&&!(V?l==`/chat/dm/${t}`:l==`/chat/dm/${e}`)&&E?(0,C.jsx)("div",{ref:_,className:"fixed top-0 left-0 w-full h-screen z-[999] pointer-events-none flex items-center justify-end pr-10",children:(0,C.jsxs)(v.P.aside,{drag:!0,dragConstraints:_,dragMomentum:!1,whileDrag:{scale:1.1},className:(0,h.A)("pointer-events-auto \n        rounded bg-gray-800  relative\n        shadow-lg shadow-slate-200 dark:shadow-slate-800 \n        cursor-move overflow-hidden\n        w-64 h-80\n        "),children:[(0,C.jsx)("div",{className:"absolute right-0-0 top-0 w-40 h-32",id:`CAMERA_${t}`}),(0,C.jsxs)("div",{className:(0,h.A)("absolute left-0 top-0 py-5 w-full h-full flex flex-col justify-between items-center",R?"bg-transparent":"bg-gray-800"),children:[(0,C.jsxs)("div",{className:"flex flex-col gap-2 items-center",children:[(0,C.jsx)("div",{className:"rounded-full overflow-hidden w-20 h-20 shrink-0",children:(0,C.jsx)(p.A,{name:O,src:k,width:80,height:80,className:"h-20"})}),(0,C.jsx)("span",{className:"text-white mb-2",children:O})]}),(0,C.jsxs)("div",{className:"flex flex-col gap-1 items-center my-4",children:[(0,C.jsx)(u.A,{size:18,lineWeight:3,speed:1,color:"#aaa"}),(0,C.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:V?"Calling":"Incoming call"})]}),(0,C.jsxs)("div",{className:(0,h.A)("flex gap-3",R?"h-full items-end":""),children:[(0,C.jsx)(f.A,{tip:"Disconnect",placement:"top",children:(0,C.jsx)("button",{onClick:()=>{(V||2==j.ids.length)&&b(),o((0,r.eu)(!1))},className:"flex-center bg-red-600 hover:bg-red-700 py-2 px-3 rounded-lg",children:(0,C.jsx)(m.A,{className:"w-6 h-6"})})}),!V&&(0,C.jsx)(f.A,{tip:"Answer",placement:"top",children:(0,C.jsx)("button",{disabled:A,onClick:()=>{x(),n(`/chat/dm/${e}`)},className:"flex-center bg-green-600 hover:bg-green-700 py-2 px-3 rounded-lg",children:(0,C.jsx)(w.A,{className:"w-6 h-6 fill-white"})})})]})]})]})}):null};var x,A;l.A.setLogLevel(4),window.VOICE_TRACK_MAP=null!==(x=window.VOICE_TRACK_MAP)&&void 0!==x?x:{},window.VIDEO_TRACK_MAP=null!==(A=window.VIDEO_TRACK_MAP)&&void 0!==A?A:{};const _=(0,s.GZ)(),y=()=>{const e=(0,d.GV)((e=>{var t;return null===(t=e.authData.user)||void 0===t?void 0:t.uid}),a.bN),t=(0,d.GV)((e=>e.voice.callingFrom),a.bN),n=(0,d.GV)((e=>e.voice.callingTo),a.bN),c=(0,d.GV)((e=>e.voice.list),a.bN),u=(0,d.GV)((e=>e.voice.voicing),a.bN),{data:h}=(0,o.A4)(),[v]=(0,o.CH)();(0,o.mK)({page_no:0,page_size:100},{skip:!h||!navigator.onLine,pollingInterval:1e4});const m=(0,a.wA)();return(0,i.useEffect)((()=>{const e=e=>{var t;if("CONNECTED"===(null===(t=window.VOICE_CLIENT)||void 0===t?void 0:t.connectionState))return e.preventDefault(),e.returnValue=""};return window.VOICE_CLIENT||_||((async()=>{const e=l.A.createClient({mode:"rtc",codec:"vp8"});e.enableAudioVolumeIndicator(),e.on("user-published",(async(t,n)=>{var i;await e.subscribe(t,n),"audio"==n&&t.hasAudio&&(null===(i=t.audioTrack)||void 0===i||i.play(),window.VOICE_TRACK_MAP[+t.uid]=t.audioTrack),"video"==n&&t.hasVideo&&(m((0,r.$y)({uid:+t.uid,info:{video:!0}})),window.VIDEO_TRACK_MAP[+t.uid]=t.videoTrack,(0,s.Qv)(+t.uid)),e.on("user-unpublished",(e=>{e.hasAudio||m((0,r.$y)({uid:+e.uid,info:{muted:!0}})),e.hasVideo||(m((0,r.$y)({uid:+e.uid,info:{video:!1,shareScreen:!1}})),window.VIDEO_TRACK_MAP[+e.uid]=null,document.querySelector(`#CAMERA_${e.uid}`).classList.remove("h-[120px]"))})),e.on("user-left",((e,t)=>{switch(t){case"Quit":case"ServerTimeOut":m((0,r.Rl)(+e.uid)),window.VOICE_TRACK_MAP[+e.uid]=null,window.VIDEO_TRACK_MAP[+e.uid]=null}})),e.on("volume-indicator",(e=>{e.forEach(((e,t)=>{e.uid,e.level;const{uid:n,level:i}=e;m((0,r.$y)({uid:+n,info:{speakingVolume:i}}))}))})),e.on("network-quality",(e=>{const{downlinkNetworkQuality:t}=e;m((0,r.OP)(t))})),e.on("connection-state-change",((e,t,n)=>{m((0,r.bp)(e))})),e.on("user-info-updated",((e,t)=>{switch(t){case"mute-audio":m((0,r.$y)({uid:+e,info:{muted:!0}}));break;case"unmute-audio":m((0,r.$y)({uid:+e,info:{muted:!1}}));break;case"mute-video":m((0,r.$y)({uid:+e,info:{video:!1}}));break;case"unmute-video":m((0,r.$y)({uid:+e,info:{video:!0}}))}}))})),e.on("user-joined",(async e=>{e.uid,m((0,r.Oy)(+e.uid))})),l.A.onMicrophoneChanged=e=>{},window.VOICE_CLIENT=e})(),window.addEventListener("beforeunload",e,{capture:!0})),()=>{window.removeEventListener("beforeunload",e,{capture:!0})}}),[u]),(0,i.useEffect)((()=>{if(_)return;const t=c.filter((t=>"dm"==t.context&&t.id==e));if(t.length){const[n]=t,{memberCount:i,channelName:a,id:l}=n;1==i&&v(a).then((t=>{var n;const[i]=null!==(n=t.data)&&void 0!==n?n:[];i&&i!=e&&m((0,r.uU)({from:i,to:l}))}))}}),[c,e,_]),0!==t?(0,C.jsx)(b,{from:t,to:n}):null},E=(0,i.memo)(y)},8776:(e,t,n)=>{n.d(t,{A:()=>h});var i=n(52205),a=n(25472);const l=n.p+"static/media/join.32e45d691d059a55188a.wav";var o=n(13631),r=n(13050),d=n(48979),s=n(80724),c=n(21444);const u=new Audio(l),h=({id:e,context:t="channel"})=>{const n=(0,i.wA)(),l=(0,s.GV)((e=>{var t,n;return null!==(t=null===(n=e.authData.user)||void 0===n?void 0:n.uid)&&void 0!==t?t:0}),i.bN),h=(0,s.GV)((e=>e.voice.voicing),i.bN),v=(0,s.GV)((n=>"channel"==t?"voice_fullscreen"==n.footprint.channelAsides[e]:"voice_fullscreen"==n.footprint.dmAsides[e]),i.bN),m=(0,s.GV)((e=>{var t;return null!==(t=e.voice.devices.filter((e=>"audioinput"==e.kind)))&&void 0!==t?t:[]}),i.bN),w=(0,s.GV)((e=>{var t;return null!==(t=e.voice.devices.filter((e=>"audiooutput"==e.kind)))&&void 0!==t?t:[]}),i.bN),p=(0,s.GV)((e=>{var t;return null!==(t=e.voice.devices.filter((e=>"videoinput"==e.kind)))&&void 0!==t?t:[]}),i.bN),f=(0,s.GV)((e=>e.voice.audioInputDeviceId),i.bN),g=(0,s.GV)((e=>e.voice.audioOutputDeviceId),i.bN),C=(0,s.GV)((e=>e.voice.videoInputDeviceId),i.bN),[b]=(0,o.lY)(),x=async()=>{const i=window.VIDEO_TRACK_MAP[l];if(i){var a;await(null===(a=window.VOICE_CLIENT)||void 0===a?void 0:a.unpublish(i)),i.close(),window.VIDEO_TRACK_MAP[l]=null;document.querySelector(`#CAMERA_${l}`).classList.remove("h-[120px]"),n((0,d.rR)({video:!1,shareScreen:!1,id:e,context:t}))}},A=async()=>{var i;let a=window.VIDEO_TRACK_MAP[l];if(!a)return;await(null===(i=window.VOICE_CLIENT)||void 0===i?void 0:i.unpublish(a)),"close"in a?a.close():a[0].close(),window.VIDEO_TRACK_MAP[l]=null;document.querySelector(`#CAMERA_${l}`).classList.remove("h-[120px]"),n((0,d.rR)({video:!1,shareScreen:!1,id:e,context:t}))},_=!!h&&(h.id==e&&h.context==t);return{setMute:i=>{const a=window.VOICE_TRACK_MAP[l];a&&(a.setMuted(i),0==i&&null!==h&&void 0!==h&&h.deafen&&(Object.entries(window.VOICE_TRACK_MAP).forEach((([,e])=>{null===e||void 0===e||e.setVolume(100)})),n((0,d.rR)({muted:!1,id:e,context:t}))),n((0,d.rR)({muted:i,id:e,context:t})))},setDeafen:i=>{const a=window.VOICE_TRACK_MAP[l];a&&(i?(a.setMuted(!0),Object.entries(window.VOICE_TRACK_MAP).forEach((([,e])=>{null===e||void 0===e||e.setVolume(0)}))):(a.setMuted(!1),Object.entries(window.VOICE_TRACK_MAP).forEach((([,e])=>{null===e||void 0===e||e.setVolume(100)}))),n((0,d.rR)({deafen:i,id:e,context:t})))},leave:async()=>{const i=window.VOICE_TRACK_MAP[l],a=window.VIDEO_TRACK_MAP[l];if(window.VOICE_CLIENT){await window.VOICE_CLIENT.leave(),i&&(i.close(),window.VOICE_TRACK_MAP[l]=null),a&&(a.close(),window.VIDEO_TRACK_MAP[l]=null),window.VOICE_TRACK_MAP={},window.VIDEO_TRACK_MAP={},n((0,d.rR)(null));const o="channel"==t?r.jn:r.fd;n(o({id:e,aside:"dm"==t?"voice":null})),n((0,d.m0)({id:e,context:t,memberCount:"dm"==t?1:0,channelName:`vocechat:${t}:${e}`}))}},voicingInfo:h,joining:h?h.joining:void 0,joinedAtThisContext:_,joined:!!h,joinVoice:async()=>{n((0,d.rR)({id:e,context:t,joining:!0}));const i=await b("channel"==t?{gid:e}:{uid:e});if("error"in i)console.error("generate agora token error"),n((0,d.rR)({joining:!1,id:e,context:t}));else{console.table(i.data);const{channel_name:r,app_id:s,agora_token:c,uid:h}=i.data;if(window.VOICE_CLIENT){await window.VOICE_CLIENT.join(s,r,c,h);const i=await a.A.createMicrophoneAudioTrack({microphoneId:f});await window.VOICE_CLIENT.publish(i);try{await u.play()}catch(o){console.warn("play join sound failed!",o)}n((0,d.rR)({deafen:!1,muted:!1,joining:!1,id:e,context:t})),n((0,d.Oy)(h)),window.VOICE_TRACK_MAP[l]=i}}},openCamera:async()=>{var i;const o=await a.A.createCameraVideoTrack({cameraId:C});await A(),await(null===(i=window.VOICE_CLIENT)||void 0===i?void 0:i.publish(o)),n((0,d.rR)({video:!0,shareScreen:!1,id:e,context:t})),window.VIDEO_TRACK_MAP[l]=o,(0,c.Qv)(l)},closeCamera:x,startShareScreen:async()=>{try{var i;const o=await a.A.createScreenVideoTrack({selfBrowserSurface:"exclude",encoderConfig:"1080p_1",optimizationMode:"detail"});await x(),await(null===(i=window.VOICE_CLIENT)||void 0===i?void 0:i.publish(o)),n((0,d.rR)({video:!1,shareScreen:!0,id:e,context:t})),window.VIDEO_TRACK_MAP[l]=o,(0,c.Qv)(l),n("channel"==t?(0,r.jn)({id:e,aside:"voice_fullscreen"}):(0,r.fd)({id:e,aside:"voice_fullscreen"})),n((0,d.Hm)({uid:l,action:"pin"})),"close"in o&&(o.getMediaStreamTrack().onended=()=>{A()})}catch(o){}},stopShareScreen:A,enterFullscreen:i=>{n("channel"==t?(0,r.jn)({id:e,aside:"voice_fullscreen"}):(0,r.fd)({id:e,aside:"voice_fullscreen"})),i&&n((0,d.Hm)({uid:i,action:"pin"}))},exitFullscreen:()=>{n("channel"==t?(0,r.jn)({id:e,aside:"voice"}):(0,r.fd)({id:e,aside:null}))},fullscreen:v,audioInputDevices:m,audioOutputDevices:w,videoInputDevices:p,audioInputDeviceId:f,audioOutputDeviceId:g,videoInputDeviceId:C}}},20905:(e,t,n)=>{n.d(t,{A:()=>p});var i=n(81084),a=n(71017),l=n(43307),o=n(52205),r=n(76644),d=n(30968),s=n(72793),c=n(25303),u=n(13050),h=n(48979),v=n(80724),m=n(47789),w=n(58156);const p=({uid:e,cid:t})=>{const{joinVoice:n,joined:p,joining:f=!1,joinedAtThisContext:g}=(0,m.c)({id:null!==e&&void 0!==e?e:0,context:"dm"}),C=(0,o.wA)(),{t:b}=(0,l.Bd)(),[x,A]=(0,i.useState)(void 0),_=(0,r.RQ)(`/users/${e}`),[y]=(0,c.QI)(),[E,{isSuccess:j}]=(0,c.H7)(),[N,{isSuccess:I}]=(0,c.Gv)(),[V,{isSuccess:O}]=(0,s.Yl)(),k=(0,r.Zp)(),{copy:R}=(0,w.A)(),M=(0,v.GV)((t=>"undefined"!==typeof e?t.users.byId[e]:void 0),o.bN),T=(0,v.GV)((e=>"undefined"!==typeof t?e.channels.byId[t]:void 0),o.bN),L=(0,v.GV)((e=>e.authData.user),o.bN),{show_email:D=!0,dm_to_member:P=!0}=null!==T&&void 0!==T?T:{};(0,i.useEffect)((()=>{A(null!==e&&void 0!==e?e:null===L||void 0===L?void 0:L.uid)}),[e,L]),(0,i.useEffect)((()=>{j&&a.Ay.success(b("tip.update"))}),[j]),(0,i.useEffect)((()=>{(O||I)&&(a.Ay.success(b("tip.delete")),I&&_&&k("/users"))}),[O,I,_]);const $=!(null===L||void 0===L||!L.is_admin),K=null===L||void 0===L?void 0:L.uid,G=!!t&&!(null!==T&&void 0!==T&&T.is_public)&&$,S=!!t&&!(null!==T&&void 0!==T&&T.is_public)&&($||(null===T||void 0===T?void 0:T.owner)==K)&&e!=(null===T||void 0===T?void 0:T.owner),F=$&&K!=e&&!t&&1!==e,B=K!=e,Z=K!=e,U=!!t&&((null===L||void 0===L?void 0:L.is_admin)||(null===T||void 0===T?void 0:T.owner)==(null===L||void 0===L?void 0:L.uid));return{isAdmin:!(null===M||void 0===M||!M.is_admin),updateRole:()=>{e&&E({id:e,is_admin:!(null!==M&&void 0!==M&&M.is_admin)})},canUpdateRole:$&&K!=e&&1!=e,removeFromContact:()=>{e&&y({target_uid:e,action:"remove"})},canBlock:B,canRemoveFromContact:Z,blocked:"blocked"==(null===M||void 0===M?void 0:M.status),blockThisContact:()=>{void 0!==e&&y({target_uid:e,action:"block"})},unblockThisContact:()=>{void 0!==e&&y({target_uid:e,action:"unblock"})},canInviteChannel:U,canDeleteChannel:G,canRemove:F,removeUser:e=>{const t=!Number.isNaN(+e)&&e||x;t&&(N(t),(0,d.cJ)())},startChat:()=>{k(`/chat/dm/${e}`)},removeFromChannel:e=>{if(!t)return;const n=!Number.isNaN(+e)&&e||x;n&&(V({id:+t,members:[+n]}),(0,d.cJ)())},canRemoveFromChannel:S,canCopyEmail:!(null===M||void 0===M||!M.email)&&D,copyEmail:e=>{const t="string"==typeof e&&e||(null===M||void 0===M?void 0:M.email);R(t||""),(0,d.cJ)()},canDM:P,startCall:()=>{if(f||p)return void alert("You have joined another channel, please leave first!");n();const t={id:null!==e&&void 0!==e?e:0,aside:"voice"};var i;(C((0,u.fd)(t)),g)||C((0,h.uU)({from:null!==(i=null===L||void 0===L?void 0:L.uid)&&void 0!==i?i:0,to:e,calling:!1}));k(`/chat/dm/${e}`)}}}}}]);