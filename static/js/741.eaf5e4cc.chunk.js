"use strict";(globalThis.webpackChunkvocechat_web=globalThis.webpackChunkvocechat_web||[]).push([[741],{38761:(e,n,i)=>{i.d(n,{Z:()=>d});var t,o=i(70537);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},a.apply(this,arguments)}const l=(e,n)=>{let{title:i,titleId:l,...d}=e;return o.createElement("svg",a({width:24,height:24,viewBox:"0 0 24 24",fill:"white",xmlns:"http://www.w3.org/2000/svg",ref:n,"aria-labelledby":l},d),i?o.createElement("title",{id:l},i):null,t||(t=o.createElement("path",{d:"M21.7806 2.21967C22.0735 2.51256 22.0735 2.98744 21.7806 3.28033L18.5609 6.5L21.7806 9.71967C22.0735 10.0126 22.0735 10.4874 21.7806 10.7803C21.4877 11.0732 21.0128 11.0732 20.7199 10.7803L17.5002 7.56066L14.2806 10.7803C13.9877 11.0732 13.5128 11.0732 13.2199 10.7803C12.927 10.4874 12.927 10.0126 13.2199 9.71967L16.4396 6.5L13.2199 3.28033C12.927 2.98744 12.927 2.51256 13.2199 2.21967C13.5128 1.92678 13.9877 1.92678 14.2806 2.21967L17.5002 5.43934L20.7199 2.21967C21.0128 1.92678 21.4877 1.92678 21.7806 2.21967ZM9.36737 3.31232L10.2271 5.33967C10.6018 6.22312 10.3939 7.26203 9.71313 7.90815L7.81881 9.70616C7.93569 10.7816 8.2972 11.8406 8.90334 12.8832C9.50948 13.9257 10.2665 14.7905 11.1744 15.4776L13.4496 14.7189C14.312 14.4313 15.2512 14.7618 15.7802 15.539L17.0125 17.3495C17.6275 18.2529 17.5169 19.4993 16.7538 20.2653L15.9361 21.0862C15.1222 21.9033 13.9597 22.1997 12.8843 21.8643C10.3454 21.0723 8.01109 18.7211 5.88132 14.8107C3.74845 10.8945 2.9957 7.57189 3.62307 4.84289C3.88707 3.69457 4.70458 2.78009 5.77209 2.43899L6.84868 2.09498C7.8575 1.77263 8.93535 2.29358 9.36737 3.31232Z"})))},d=(0,o.forwardRef)(l)},97655:(e,n,i)=>{i.d(n,{Z:()=>d});var t,o=i(70537);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},a.apply(this,arguments)}const l=(e,n)=>{let{title:i,titleId:l,...d}=e;return o.createElement("svg",a({width:24,height:24,viewBox:"0 0 24 24",fill:"#70707B",xmlns:"http://www.w3.org/2000/svg",ref:n,"aria-labelledby":l},d),i?o.createElement("title",{id:l},i):null,t||(t=o.createElement("path",{d:"M7.7716 2.43923L8.84819 2.09522C9.85701 1.77287 10.9349 2.29382 11.3669 3.31256L12.2266 5.33991C12.6013 6.22336 12.3934 7.26227 11.7126 7.9084L9.81832 9.70641C9.9352 10.7819 10.2967 11.8409 10.9029 12.8834C11.509 13.9259 12.266 14.7907 13.1739 15.4778L15.4491 14.7191C16.3115 14.4315 17.2507 14.762 17.7797 15.5392L19.0121 17.3498C19.627 18.2532 19.5164 19.4995 18.7534 20.2655L17.9356 21.0865C17.1217 21.9036 15.9592 22.2 14.8838 21.8645C12.3449 21.0726 10.0106 18.7214 7.88083 14.8109C5.74796 10.8947 4.99521 7.57214 5.62258 4.84313C5.88658 3.69482 6.70409 2.78033 7.7716 2.43923Z"})))},d=(0,o.forwardRef)(l)},76552:(e,n,i)=>{i.d(n,{Z:()=>d});var t,o=i(70537);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},a.apply(this,arguments)}const l=(e,n)=>{let{title:i,titleId:l,...d}=e;return o.createElement("svg",a({width:24,height:24,viewBox:"0 0 24 24",fill:"#616161",xmlns:"http://www.w3.org/2000/svg",ref:n,"aria-labelledby":l},d),i?o.createElement("title",{id:l},i):null,t||(t=o.createElement("path",{d:"M8 12C8 13.1046 7.10457 14 6 14C4.89543 14 4 13.1046 4 12C4 10.8954 4.89543 10 6 10C7.10457 10 8 10.8954 8 12ZM14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12ZM18 14C19.1046 14 20 13.1046 20 12C20 10.8954 19.1046 10 18 10C16.8954 10 16 10.8954 16 12C16 13.1046 16.8954 14 18 14Z"})))},d=(0,o.forwardRef)(l)},16956:(e,n,i)=>{i.d(n,{Z:()=>d});var t=i(70537),o=i(26602),a=i(80683);function l(e){return e<=16?8:e<=24?12:e<=32?16:e<=40?18:e<=56?22:e<=80?48:64}const d=e=>{let{src:n="",name:i="Deleted User",type:d="user",width:s,height:r,...c}=e;const[u,v]=(0,t.useState)(!1),m=()=>{v(!0)};if(!u&&n)return(0,a.jsx)("img",{width:s,height:r,src:n,onError:m,...c});let h=(0,o.Qm)(i).substring(0,6);const w=h.length,p=w>2?(11-w)/10:1;return(0,a.jsx)("div",{className:`rounded-full flex-center ${c.className||""}`,style:{width:s,height:r,fontSize:l(s),fontWeight:400,fontFamily:"'Lato', 'Lato-Regular', 'Helvetica Neue'",background:"channel"===d?"#EAECF0":"#4c99e9",color:"channel"===d?"#475467":"#FFFFFF"},children:(0,a.jsx)("span",{className:"whitespace-nowrap",style:{transform:`scale(${p})`},children:h})})}},62846:(e,n,i)=>{i.d(n,{Z:()=>x});var t,o=i(70537),a=i(14566),l=i(64084),d=i(7829),s=i(57425),r=i(65809),c=i(66160),u=i(22481),v=i(97655);function m(){return m=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},m.apply(this,arguments)}const h=(e,n)=>{let{title:i,titleId:a,...l}=e;return o.createElement("svg",m({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:n,"aria-labelledby":a},l),i?o.createElement("title",{id:a},i):null,t||(t=o.createElement("path",{d:"M12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C10.3596 22 8.77516 21.6039 7.35578 20.8583L3.06538 21.9753C2.6111 22.0937 2.1469 21.8213 2.02858 21.367C1.99199 21.2266 1.99198 21.0791 2.02855 20.9386L3.1449 16.6502C2.3972 15.2294 2 13.6428 2 12C2 6.47715 6.47715 2 12 2Z",fill:"#22CCEE"})))},w=(0,o.forwardRef)(h);var p=i(76552),f=i(16956),C=i(80683);const g=e=>{let{uid:n,type:i="embed",cid:t}=e;const{data:o}=(0,r.j9)(),{t:m}=(0,a.$G)("member"),{t:h}=(0,a.$G)(),{canCopyEmail:g,copyEmail:x,startCall:b,removeFromChannel:I,canRemoveFromChannel:_,canRemove:E,removeUser:y}=(0,u.Z)({uid:n,cid:t}),{data:j}=(0,c.CG)((e=>({data:e.users.byId[n]})));if(!j)return null;const{name:A,email:O,avatar:T}=j,N="card"==i,V=!N&&E,M=O||_||V,L="cursor-pointer flex flex-col items-center gap-1 rounded-lg w-32 text-primary-400 bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 text-sm pt-3.5 pb-3",k=(0,s.Z)("flex-center flex-col gap-1 z-[99] mt-20 select-none",N?"p-4 w-[280px] bg-white dark:bg-gray-800 drop-shadow rounded-md":"md:w-[432px]");return(0,C.jsxs)("div",{className:k,children:[(0,C.jsx)(f.Z,{width:80,height:80,className:"rounded-full w-20 h-20 object-cover",src:T,name:A}),(0,C.jsx)("h2",{className:"text-lg select-text font-bold text-gray-900 dark:text-white",children:A}),(0,C.jsx)("span",{className:"text-sm text-gray-400 dark:text-gray-200 select-text",children:O}),(0,C.jsxs)("ul",{className:(0,s.Z)("mt-6 flex flex-col md:flex-row items-center gap-2",N&&"pb-0.5"),children:[(0,C.jsx)(l.OL,{to:`/chat/dm/${n}`,children:(0,C.jsxs)("li",{className:`${L} icon chat`,children:[(0,C.jsx)(w,{}),(0,C.jsx)("span",{children:m("send_msg")})]})}),o&&"embed"==i&&(0,C.jsxs)("li",{role:"button",onClick:b,className:`${L} icon chat`,children:[(0,C.jsx)(v.Z,{className:"fill-primary-400"}),(0,C.jsx)("span",{children:m("call")})]}),(0,C.jsx)(d.ZP,{disabled:!M,interactive:!0,popperOptions:{strategy:"fixed"},placement:"right",trigger:"click",hideOnClick:!0,content:(0,C.jsxs)("ul",{className:"context-menu",children:[o&&"card"==i&&(0,C.jsx)("li",{className:"item",onClick:b,children:m("call")}),g&&(0,C.jsx)("li",{className:"item",onClick:x.bind(void 0,O),children:m("copy_email")}),_&&(0,C.jsx)("li",{className:"item danger",onClick:I.bind(null,n),children:m("remove_from_channel")}),V&&(0,C.jsx)("li",{className:"item danger",onClick:y.bind(null,n),children:m("remove")})]}),children:(0,C.jsxs)("li",{className:`${L} icon ${M?"":"text-gray-500"}`,children:[(0,C.jsx)(p.Z,{className:M?"fill-primary-500":""}),(0,C.jsx)("span",{children:h("more")})]})})]})]})},x=(0,o.memo)(g)},33478:(e,n,i)=>{i.d(n,{Z:()=>s});var t=i(7829),o=i(57425),a=i(26602),l=i(80683);const d=e=>{let{placement:n}=e;if("left"==n)return null;const i=(0,o.Z)("w-3 h-3 bg-inherit absolute rounded-[1px] origin-center rotate-45","right"==n&&"left-0 top-1/2 -translate-x-1/2 -translate-y-1/2","top"==n&&"left-1/2 bottom-0 -translate-x-1/2 translate-y-1/2","bottom"==n&&"top-0 left-1/2 -translate-x-1/2 -translate-y-1/2");return(0,l.jsx)("i",{className:i})},s=e=>{let{tip:n="",placement:i="right",delay:o=null,children:s,...r}=e;return(0,l.jsx)(t.ZP,{disabled:(0,a.tq)(),offset:[0,18],duration:o?[300,250]:0,delay:null!==o&&void 0!==o?o:[150,0],placement:i,content:(0,l.jsxs)("div",{className:"relative bg-white dark:bg-gray-800 px-3 py-2 text-xs rounded-lg drop-shadow text-gray-700 dark:text-gray-100",children:[(0,l.jsx)(d,{placement:i}),n]}),...r,children:s})}},56885:(e,n,i)=>{i.d(n,{Z:()=>y,M:()=>g.Z});var t=i(70537),o=i(3074),a=i(80829),l=i.n(a),d=i(65809),s=i(971),r=i(66160),c=i(26602),u=i(15924),v=i(37076),m=i(57425),h=i(86429),w=i(38761),p=i(97655),f=i(16956),C=i(33478),g=i(15475),x=i(80683);const b=e=>{let{from:n,to:i=0}=e;const a=(0,u.s0)(),{pathname:l}=(0,u.TH)(),d=(0,o.I0)(),{leave:b,joinVoice:I,joining:_}=(0,g.Z)({id:i,context:"dm"}),E=(0,t.useRef)(null),{calling:y,voicingMembers:j,fromUser:A,toUser:O,loginUser:T}=(0,r.CG)((e=>({calling:e.voice.calling,voicingMembers:e.voice.voicingMembers,fromUser:e.users.byId[n],toUser:e.users.byId[i],loginUser:e.authData.user}))),N=(null===T||void 0===T?void 0:T.uid)!==O.uid;(0,t.useEffect)((()=>{j.ids.forEach((e=>{(0,c.L_)(e)}))}),[j.ids]);const{name:V,avatar:M}=N?O:A,L=2==j.ids.length;return A&&O&&!L&&!(N?l==`/chat/dm/${i}`:l==`/chat/dm/${n}`)&&y?(0,x.jsx)("div",{ref:E,className:"fixed top-0 left-0 w-full h-screen z-[999] pointer-events-none flex items-center justify-end pr-10",children:(0,x.jsxs)(h.E.aside,{drag:!0,dragConstraints:E,dragMomentum:!1,whileDrag:{scale:1.1},className:(0,m.Z)("pointer-events-auto \n        rounded bg-gray-800  relative\n        shadow-lg shadow-slate-200 dark:shadow-slate-800 \n        cursor-move overflow-hidden\n        w-64 h-80\n        "),children:[(0,x.jsx)("div",{className:"absolute right-0-0 top-0 w-40 h-32",id:`CAMERA_${i}`}),(0,x.jsxs)("div",{className:(0,m.Z)("absolute left-0 top-0 py-5 w-full h-full flex flex-col justify-between items-center",L?"bg-transparent":"bg-gray-800"),children:[(0,x.jsxs)("div",{className:"flex flex-col gap-2 items-center",children:[(0,x.jsx)("div",{className:"rounded-full overflow-hidden w-20 h-20 shrink-0",children:(0,x.jsx)(f.Z,{name:V,src:M,width:80,height:80,className:"h-20"})}),(0,x.jsx)("span",{className:"text-white mb-2",children:V})]}),(0,x.jsxs)("div",{className:"flex flex-col gap-1 items-center my-4",children:[(0,x.jsx)(v.Z,{size:18,lineWeight:3,speed:1,color:"#aaa"}),(0,x.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:N?"Calling":"Incoming call"})]}),(0,x.jsxs)("div",{className:(0,m.Z)("flex gap-3",L?"h-full items-end":""),children:[(0,x.jsx)(C.Z,{tip:"Disconnect",placement:"top",children:(0,x.jsx)("button",{onClick:()=>{(N||2==j.ids.length)&&b(),d((0,s.Qv)(!1))},className:"flex-center bg-red-600 hover:bg-red-700 py-2 px-3 rounded-lg",children:(0,x.jsx)(w.Z,{className:"w-6 h-6"})})}),!N&&(0,x.jsx)(C.Z,{tip:"Answer",placement:"top",children:(0,x.jsx)("button",{disabled:_,onClick:()=>{I(),a(`/chat/dm/${n}`)},className:"flex-center bg-green-600 hover:bg-green-700 py-2 px-3 rounded-lg",children:(0,x.jsx)(p.Z,{className:"w-6 h-6 fill-white"})})})]})]})]})}):null};var I,_;l().setLogLevel(4),window.VOICE_TRACK_MAP=null!==(I=window.VOICE_TRACK_MAP)&&void 0!==I?I:{},window.VIDEO_TRACK_MAP=null!==(_=window.VIDEO_TRACK_MAP)&&void 0!==_?_:{};const E=()=>{const{from:e,to:n,voiceList:i,loginUid:a,voicingInfo:u}=(0,r.CG)((e=>{var n;return{voicingInfo:e.voice.voicing,voiceList:e.voice.list,from:e.voice.callingFrom,to:e.voice.callingTo,loginUid:null===(n=e.authData.user)||void 0===n?void 0:n.uid}})),{data:v}=(0,d.j9)(),[m]=(0,d.Qg)();(0,d.K0)({page_no:0,page_size:100},{skip:!v||!navigator.onLine,pollingInterval:5e3});const h=(0,o.I0)();return(0,t.useEffect)((()=>{const e=e=>{var n;if("CONNECTED"===(null===(n=window.VOICE_CLIENT)||void 0===n?void 0:n.connectionState))return e.preventDefault(),e.returnValue=""};return window.addEventListener("beforeunload",e,{capture:!0}),window.VOICE_CLIENT||(async()=>{const e=l().createClient({mode:"rtc",codec:"vp8"});e.enableAudioVolumeIndicator(),e.on("user-published",(async(n,i)=>{var t;await e.subscribe(n,i),"audio"==i&&n.hasAudio&&(null===(t=n.audioTrack)||void 0===t||t.play(),window.VOICE_TRACK_MAP[+n.uid]=n.audioTrack),"video"==i&&n.hasVideo&&(h((0,s.sm)({uid:+n.uid,info:{video:!0}})),window.VIDEO_TRACK_MAP[+n.uid]=n.videoTrack,(0,c.L_)(+n.uid)),e.on("user-unpublished",(e=>{e.hasAudio||h((0,s.sm)({uid:+e.uid,info:{muted:!0}})),e.hasVideo||(h((0,s.sm)({uid:+e.uid,info:{video:!1,shareScreen:!1}})),window.VIDEO_TRACK_MAP[+e.uid]=null,document.querySelector(`#CAMERA_${e.uid}`).classList.remove("h-[120px]"))})),e.on("user-left",((e,n)=>{switch(n){case"Quit":case"ServerTimeOut":h((0,s.h_)(+e.uid)),window.VOICE_TRACK_MAP[+e.uid]=null,window.VIDEO_TRACK_MAP[+e.uid]=null}})),e.on("volume-indicator",(e=>{e.forEach(((e,n)=>{e.uid,e.level;const{uid:i,level:t}=e;h((0,s.sm)({uid:+i,info:{speakingVolume:t}}))}))})),e.on("network-quality",(e=>{const{downlinkNetworkQuality:n}=e;h((0,s.U_)(n))})),e.on("connection-state-change",((e,n,i)=>{h((0,s.$6)(e))})),e.on("user-info-updated",((e,n)=>{switch(n){case"mute-audio":h((0,s.sm)({uid:+e,info:{muted:!0}}));break;case"unmute-audio":h((0,s.sm)({uid:+e,info:{muted:!1}}));break;case"mute-video":h((0,s.sm)({uid:+e,info:{video:!1}}));break;case"unmute-video":h((0,s.sm)({uid:+e,info:{video:!0}}))}}))})),e.on("user-joined",(async e=>{e.uid,h((0,s.Bu)(+e.uid))})),l().onMicrophoneChanged=e=>{},window.VOICE_CLIENT=e})(),()=>{window.removeEventListener("beforeunload",e,{capture:!0})}}),[u]),(0,t.useEffect)((()=>{const e=i.filter((e=>"dm"==e.context&&e.id==a));if(e.length){const[n]=e,{memberCount:i,channelName:t,id:o}=n;1==i&&m(t).then((e=>{var n;const[i]=null!==(n=e.data)&&void 0!==n?n:[];i&&i!=a&&h((0,s.vH)({from:i,to:o}))}))}}),[i,a]),0!==e?(0,x.jsx)(b,{from:e,to:n}):null},y=(0,t.memo)(E)},15475:(e,n,i)=>{i.d(n,{Z:()=>m});var t=i(3074),o=i(80829),a=i.n(o);const l=i.p+"static/media/join.32e45d691d059a55188a.wav";var d=i(65809),s=i(81980),r=i(971),c=i(66160),u=i(26602);const v=new Audio(l),m=e=>{let{id:n,context:i="channel"}=e;const o=(0,t.I0)(),{voicingInfo:l,loginUid:m,audioInputDevices:h,audioOutputDevices:w,videoInputDevices:p,audioInputDeviceId:f,audioOutputDeviceId:C,videoInputDeviceId:g,fullscreen:x}=(0,c.CG)((e=>{var t,o,a,l,d;return{fullscreen:"channel"==i?"voice_fullscreen"==e.footprint.channelAsides[n]:"voice_fullscreen"==e.footprint.dmAsides[n],loginUid:null!==(t=null===(o=e.authData.user)||void 0===o?void 0:o.uid)&&void 0!==t?t:0,voicingInfo:e.voice.voicing,audioInputDevices:null!==(a=e.voice.devices.filter((e=>"audioinput"==e.kind)))&&void 0!==a?a:[],audioOutputDevices:null!==(l=e.voice.devices.filter((e=>"audiooutput"==e.kind)))&&void 0!==l?l:[],videoInputDevices:null!==(d=e.voice.devices.filter((e=>"videoinput"==e.kind)))&&void 0!==d?d:[],audioInputDeviceId:e.voice.audioInputDeviceId,audioOutputDeviceId:e.voice.audioOutputDeviceId,videoInputDeviceId:e.voice.videoInputDeviceId}})),[b]=(0,d._S)(),I=async()=>{const e=window.VIDEO_TRACK_MAP[m];if(e){var t;await(null===(t=window.VOICE_CLIENT)||void 0===t?void 0:t.unpublish(e)),e.close(),window.VIDEO_TRACK_MAP[m]=null;document.querySelector(`#CAMERA_${m}`).classList.remove("h-[120px]"),o((0,r.Su)({video:!1,shareScreen:!1,id:n,context:i}))}},_=async()=>{var e;let t=window.VIDEO_TRACK_MAP[m];if(!t)return;await(null===(e=window.VOICE_CLIENT)||void 0===e?void 0:e.unpublish(t)),"close"in t?t.close():t[0].close(),window.VIDEO_TRACK_MAP[m]=null;document.querySelector(`#CAMERA_${m}`).classList.remove("h-[120px]"),o((0,r.Su)({video:!1,shareScreen:!1,id:n,context:i}))},E=!!l&&(l.id==n&&l.context==i);return{setMute:e=>{const t=window.VOICE_TRACK_MAP[m];t&&(t.setMuted(e),0==e&&null!==l&&void 0!==l&&l.deafen&&(Object.entries(window.VOICE_TRACK_MAP).forEach((e=>{let[,n]=e;null===n||void 0===n||n.setVolume(100)})),o((0,r.Su)({muted:!1,id:n,context:i}))),o((0,r.Su)({muted:e,id:n,context:i})))},setDeafen:e=>{const t=window.VOICE_TRACK_MAP[m];t&&(e?(t.setMuted(!0),Object.entries(window.VOICE_TRACK_MAP).forEach((e=>{let[,n]=e;null===n||void 0===n||n.setVolume(0)}))):(t.setMuted(!1),Object.entries(window.VOICE_TRACK_MAP).forEach((e=>{let[,n]=e;null===n||void 0===n||n.setVolume(100)}))),o((0,r.Su)({deafen:e,id:n,context:i})))},leave:async()=>{const e=window.VOICE_TRACK_MAP[m],t=window.VIDEO_TRACK_MAP[m];if(window.VOICE_CLIENT){await window.VOICE_CLIENT.leave(),e&&(e.close(),window.VOICE_TRACK_MAP[m]=null),t&&(t.close(),window.VIDEO_TRACK_MAP[m]=null),window.VOICE_TRACK_MAP={},window.VIDEO_TRACK_MAP={},o((0,r.Su)(null));const a="channel"==i?s.Kp:s.dZ;o(a({id:n,aside:"dm"==i?"voice":null})),o((0,r.IZ)({id:n,context:i,memberCount:"dm"==i?1:0,channelName:`vocechat:${i}:${n}`}))}},voicingInfo:l,joining:l?l.joining:void 0,joinedAtThisContext:E,joined:!!l,joinVoice:async()=>{o((0,r.Su)({id:n,context:i,joining:!0}));const e=await b("channel"==i?{gid:n}:{uid:n});if("error"in e)console.error("generate agora token error"),o((0,r.Su)({joining:!1,id:n,context:i}));else{console.table(e.data);const{channel_name:l,app_id:d,agora_token:s,uid:c}=e.data;if(window.VOICE_CLIENT){await window.VOICE_CLIENT.join(d,l,s,c);const e=await a().createMicrophoneAudioTrack({microphoneId:f});await window.VOICE_CLIENT.publish(e);try{await v.play()}catch(t){console.warn("play join sound failed!",t)}o((0,r.Su)({deafen:!1,muted:!1,joining:!1,id:n,context:i})),o((0,r.Bu)(c)),window.VOICE_TRACK_MAP[m]=e}}},openCamera:async()=>{var e;const t=await a().createCameraVideoTrack({cameraId:g});await _(),await(null===(e=window.VOICE_CLIENT)||void 0===e?void 0:e.publish(t)),o((0,r.Su)({video:!0,shareScreen:!1,id:n,context:i})),window.VIDEO_TRACK_MAP[m]=t,(0,u.L_)(m)},closeCamera:I,startShareScreen:async()=>{try{var e;const t=await a().createScreenVideoTrack({selfBrowserSurface:"exclude",encoderConfig:"1080p_1",optimizationMode:"detail"});await I(),await(null===(e=window.VOICE_CLIENT)||void 0===e?void 0:e.publish(t)),o((0,r.Su)({video:!1,shareScreen:!0,id:n,context:i})),window.VIDEO_TRACK_MAP[m]=t,(0,u.L_)(m),o("channel"==i?(0,s.Kp)({id:n,aside:"voice_fullscreen"}):(0,s.dZ)({id:n,aside:"voice_fullscreen"})),o((0,r.fT)({uid:m,action:"pin"})),"close"in t&&(t.getMediaStreamTrack().onended=()=>{_()})}catch(t){}},stopShareScreen:_,enterFullscreen:e=>{o("channel"==i?(0,s.Kp)({id:n,aside:"voice_fullscreen"}):(0,s.dZ)({id:n,aside:"voice_fullscreen"})),e&&o((0,r.fT)({uid:e,action:"pin"}))},exitFullscreen:()=>{o("channel"==i?(0,s.Kp)({id:n,aside:"voice"}):(0,s.dZ)({id:n,aside:null}))},fullscreen:x,audioInputDevices:h,audioOutputDevices:w,videoInputDevices:p,audioInputDeviceId:f,audioOutputDeviceId:C,videoInputDeviceId:g}}},41064:(e,n,i)=>{i.d(n,{Z:()=>l});var t=i(70537),o=i(27418),a=i(34108);const l=e=>{const{enableToast:n=!0}=e||{},[i,l]=(0,t.useState)(!1);(0,t.useEffect)((()=>{i&&n&&o.ZP.success("Copied!")}),[i]);return{copied:i,copy:function(e){let n=0;return i||(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(0,a.VP)(e).then((()=>{l(!0),n=window.setTimeout((()=>{l(!1)}),500)})):(l((e=>{const n=document.createElement("textarea");n.value=e,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n);const i=document.getSelection();if(!i)return!1;const t=i.rangeCount>0&&i.getRangeAt(0);n.select();const o=document.execCommand("copy");return document.body.removeChild(n),t&&(i.removeAllRanges(),i.addRange(t)),o})(e)),n=window.setTimeout((()=>{l(!1)}),500))),()=>{clearTimeout(n)}}}}},22481:(e,n,i)=>{i.d(n,{Z:()=>p});var t=i(70537),o=i(27418),a=i(14566),l=i(3074),d=i(15924),s=i(69195),r=i(6144),c=i(52334),u=i(81980),v=i(971),m=i(66160),h=i(56885),w=i(41064);const p=e=>{let{uid:n,cid:i}=e;const{joinVoice:p,joined:f,joining:C=!1,joinedAtThisContext:g}=(0,h.M)({id:null!==n&&void 0!==n?n:0,context:"dm"}),x=(0,l.I0)(),{t:b}=(0,a.$G)(),[I,_]=(0,t.useState)(void 0),E=(0,d.bS)(`/users/${n}`),[y]=(0,c.C6)(),[j,{isSuccess:A}]=(0,c.EO)(),[O,{isSuccess:T}]=(0,r.Cg)(),N=(0,d.s0)(),{copy:V}=(0,w.Z)(),{user:M,channel:L,loginUser:k}=(0,m.CG)((e=>({user:"undefined"!==typeof n?e.users.byId[n]:n,channel:"undefined"!==typeof i?e.channels.byId[i]:i,loginUser:e.authData.user})));(0,t.useEffect)((()=>{_(null!==n&&void 0!==n?n:null===k||void 0===k?void 0:k.uid)}),[n,k]),(0,t.useEffect)((()=>{(T||A)&&(o.ZP.success(b("tip.delete")),A&&E&&N("/users"))}),[T,A,E]);const D=!(null===k||void 0===k||!k.is_admin),Z=null===k||void 0===k?void 0:k.uid,R=!!i&&!(null!==L&&void 0!==L&&L.is_public)&&D,S=!!i&&!(null!==L&&void 0!==L&&L.is_public)&&(D||(null===L||void 0===L?void 0:L.owner)==Z)&&n!=(null===L||void 0===L?void 0:L.owner),P=D&&Z!=n&&!i&&1!==n,K=Z!=n,$=Z!=n,F=!!i&&((null===k||void 0===k?void 0:k.is_admin)||(null===L||void 0===L?void 0:L.owner)==(null===k||void 0===k?void 0:k.uid));return{removeFromContact:()=>{n&&y({target_uid:n,action:"remove"})},canBlock:K,canRemoveFromContact:$,blocked:"blocked"==(null===M||void 0===M?void 0:M.status),blockThisContact:()=>{void 0!==n&&y({target_uid:n,action:"block"})},unblockThisContact:()=>{void 0!==n&&y({target_uid:n,action:"unblock"})},canInviteChannel:F,canDeleteChannel:R,canRemove:P,removeUser:e=>{const n=!Number.isNaN(+e)&&e||I;n&&(j(n),(0,s.Bn)())},startChat:()=>{N(`/chat/dm/${n}`)},removeFromChannel:e=>{if(!i)return;const n=!Number.isNaN(+e)&&e||I;n&&(O({id:+i,members:[+n]}),(0,s.Bn)())},canRemoveFromChannel:S,canCopyEmail:!(null===M||void 0===M||!M.email),copyEmail:e=>{const n="string"==typeof e&&e||(null===M||void 0===M?void 0:M.email);V(n||""),(0,s.Bn)()},startCall:()=>{if(C||f)return void alert("You have joined another channel, please leave first!");p();const e={id:null!==n&&void 0!==n?n:0,aside:"voice"};var i;(x((0,u.dZ)(e)),g)||x((0,v.vH)({from:null!==(i=null===k||void 0===k?void 0:k.uid)&&void 0!==i?i:0,to:n,calling:!1}));N(`/chat/dm/${n}`)}}}}}]);